// source:  https://webrtc.github.io/adapter/adapter-latest.js
/*
 *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.
 *
 *  Use of this source code is governed by a BSD-style license
 *  that can be found in the LICENSE file in the root of the source
 *  tree.
 */
(function(t){if(typeof exports=="object"&&typeof module!="undefined")module.exports=t();else if(typeof define=="function"&&define.amd)define([],t);else{var e;typeof window!="undefined"?e=window:typeof global!="undefined"?e=global:typeof self!="undefined"?e=self:e=this,e.adapter=t()}})(function(){var e,t,n;return function(){function e(t,n,s){function o(i,d){if(!n[i]){if(!t[i]){var c="function"==typeof require&&require,l,r;if(!d&&c)return c(i,!0);if(a)return a(i,!0);throw l=new Error("Cannot find module '"+i+"'"),l.code="MODULE_NOT_FOUND",l}r=n[i]={exports:{}},t[i][0].call(r.exports,function(e){var n=t[i][1][e];return o(n||e)},r,r.exports,e,t,n,s)}return n[i].exports}for(var a="function"==typeof require&&require,i=0;s.length>i;i++)o(s[i]);return o}return e}()({1:[function(e,t){'use strict';var n=e('./adapter_factory.js'),s=(0,n.adapterFactory)({window:typeof window=='undefined'?void 0:window});t.exports=s},{"./adapter_factory.js":2}],2:[function(i,g,r){'use strict';Object.defineProperty(r,"__esModule",{value:!0}),r.adapterFactory=p;var d=i('./utils'),a=o(d),h=i('./chrome/chrome_shim'),n=o(h),c=i('./firefox/firefox_shim'),t=o(c),l=i('./safari/safari_shim'),s=o(l),u=i('./common_shim'),e=o(u),m=i('sdp'),f=o(m);function o(e){if(e&&e.__esModule)return e;var t={},n;if(e!=null)for(n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function p(){var d=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},i=d.window,l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0},r=a.log,o=a.detectBrowser(i),c={browserDetails:o,commonShim:e,extractVersion:a.extractVersion,disableLog:a.disableLog,disableWarnings:a.disableWarnings,sdp:f};switch(o.browser){case'chrome':if(!n||!n.shimPeerConnection||!l.shimChrome)return r('Chrome shim is not included in this adapter release.'),c;if(o.version===null)return r('Chrome shim can not determine version, not shimming.'),c;r('adapter.js shimming chrome.'),c.browserShim=n,e.shimAddIceCandidateNullOrEmpty(i,o),e.shimParameterlessSetLocalDescription(i,o),n.shimGetUserMedia(i,o),n.shimMediaStream(i,o),n.shimPeerConnection(i,o),n.shimOnTrack(i,o),n.shimAddTrackRemoveTrack(i,o),n.shimGetSendersWithDtmf(i,o),n.shimGetStats(i,o),n.shimSenderReceiverGetStats(i,o),n.fixNegotiationNeeded(i,o),e.shimRTCIceCandidate(i,o),e.shimConnectionState(i,o),e.shimMaxMessageSize(i,o),e.shimSendThrowTypeError(i,o),e.removeExtmapAllowMixed(i,o);break;case'firefox':if(!t||!t.shimPeerConnection||!l.shimFirefox)return r('Firefox shim is not included in this adapter release.'),c;r('adapter.js shimming firefox.'),c.browserShim=t,e.shimAddIceCandidateNullOrEmpty(i,o),e.shimParameterlessSetLocalDescription(i,o),t.shimGetUserMedia(i,o),t.shimPeerConnection(i,o),t.shimOnTrack(i,o),t.shimRemoveStream(i,o),t.shimSenderGetStats(i,o),t.shimReceiverGetStats(i,o),t.shimRTCDataChannel(i,o),t.shimAddTransceiver(i,o),t.shimGetParameters(i,o),t.shimCreateOffer(i,o),t.shimCreateAnswer(i,o),e.shimRTCIceCandidate(i,o),e.shimConnectionState(i,o),e.shimMaxMessageSize(i,o),e.shimSendThrowTypeError(i,o);break;case'safari':if(!s||!l.shimSafari)return r('Safari shim is not included in this adapter release.'),c;r('adapter.js shimming safari.'),c.browserShim=s,e.shimAddIceCandidateNullOrEmpty(i,o),e.shimParameterlessSetLocalDescription(i,o),s.shimRTCIceServerUrls(i,o),s.shimCreateOfferLegacy(i,o),s.shimCallbacksAPI(i,o),s.shimLocalStreamsAPI(i,o),s.shimRemoteStreamsAPI(i,o),s.shimTrackEventTransceiver(i,o),s.shimGetUserMedia(i,o),s.shimAudioContext(i,o),e.shimRTCIceCandidate(i,o),e.shimMaxMessageSize(i,o),e.shimSendThrowTypeError(i,o),e.removeExtmapAllowMixed(i,o);break;default:r('Unsupported browser!');break}return c}},{"./chrome/chrome_shim":3,"./common_shim":6,"./firefox/firefox_shim":7,"./safari/safari_shim":10,"./utils":11,sdp:12}],3:[function(s,b,e){'use strict';Object.defineProperty(e,"__esModule",{value:!0}),e.shimGetDisplayMedia=e.shimGetUserMedia=void 0;var n=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r,a,t,l=s('./getusermedia');Object.defineProperty(e,'shimGetUserMedia',{enumerable:!0,get:function(){return l.shimGetUserMedia}}),r=s('./getdisplaymedia'),Object.defineProperty(e,'shimGetDisplayMedia',{enumerable:!0,get:function(){return r.shimGetDisplayMedia}}),e.shimMediaStream=d,e.shimOnTrack=u,e.shimGetSendersWithDtmf=h,e.shimGetStats=m,e.shimSenderReceiverGetStats=f,e.shimAddTrackRemoveTrackWithNative=o,e.shimAddTrackRemoveTrack=g,e.shimPeerConnection=p,e.fixNegotiationNeeded=v,a=s('../utils.js'),t=c(a);function c(e){if(e&&e.__esModule)return e;var t={},n;if(e!=null)for(n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function d(e){e.MediaStream=e.MediaStream||e.webkitMediaStream}function u(e){if((typeof e=='undefined'?'undefined':n(e))==='object'&&e.RTCPeerConnection&&!('ontrack'in e.RTCPeerConnection.prototype)){Object.defineProperty(e.RTCPeerConnection.prototype,'ontrack',{get:function(){return this._ontrack},set:function(e){this._ontrack&&this.removeEventListener('track',this._ontrack),this.addEventListener('track',this._ontrack=e)},enumerable:!0,configurable:!0});var s=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){var t=this;return this._ontrackpoly||(this._ontrackpoly=function(n){n.stream.addEventListener('addtrack',function(i){var o=void 0,s;e.RTCPeerConnection.prototype.getReceivers?o=t.getReceivers().find(function(e){return e.track&&e.track.id===i.track.id}):o={track:i.track},s=new Event('track'),s.track=i.track,s.receiver=o,s.transceiver={receiver:o},s.streams=[n.stream],t.dispatchEvent(s)}),n.stream.getTracks().forEach(function(i){var o=void 0,s;e.RTCPeerConnection.prototype.getReceivers?o=t.getReceivers().find(function(e){return e.track&&e.track.id===i.id}):o={track:i},s=new Event('track'),s.track=i,s.receiver=o,s.transceiver={receiver:o},s.streams=[n.stream],t.dispatchEvent(s)})},this.addEventListener('addstream',this._ontrackpoly)),s.apply(this,arguments)}}else t.wrapPeerConnectionEvent(e,'track',function(e){return e.transceiver||Object.defineProperty(e,'transceiver',{value:{receiver:e.receiver}}),e})}function h(e){if((typeof e=='undefined'?'undefined':n(e))==='object'&&e.RTCPeerConnection&&!('getSenders'in e.RTCPeerConnection.prototype)&&'createDTMFSender'in e.RTCPeerConnection.prototype){var t=function(t,e){return{track:e,get dtmf(){return this._dtmf===void 0&&(e.kind==='audio'?this._dtmf=t.createDTMFSender(e):this._dtmf=null),this._dtmf},_pc:t}},s,o,i,a,r;e.RTCPeerConnection.prototype.getSenders||(e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()},s=e.RTCPeerConnection.prototype.addTrack,e.RTCPeerConnection.prototype.addTrack=function(n){var e=s.apply(this,arguments);return e||(e=t(this,n),this._senders.push(e)),e},o=e.RTCPeerConnection.prototype.removeTrack,e.RTCPeerConnection.prototype.removeTrack=function(t){o.apply(this,arguments);var e=this._senders.indexOf(t);e!==-1&&this._senders.splice(e,1)}),i=e.RTCPeerConnection.prototype.addStream,e.RTCPeerConnection.prototype.addStream=function(e){var n=this;this._senders=this._senders||[],i.apply(this,[e]),e.getTracks().forEach(function(e){n._senders.push(t(n,e))})},a=e.RTCPeerConnection.prototype.removeStream,e.RTCPeerConnection.prototype.removeStream=function(t){var e=this;this._senders=this._senders||[],a.apply(this,[t]),t.getTracks().forEach(function(n){var t=e._senders.find(function(e){return e.track===n});t&&e._senders.splice(e._senders.indexOf(t),1)})}}else(typeof e=='undefined'?'undefined':n(e))==='object'&&e.RTCPeerConnection&&'getSenders'in e.RTCPeerConnection.prototype&&'createDTMFSender'in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!('dtmf'in e.RTCRtpSender.prototype)&&(r=e.RTCPeerConnection.prototype.getSenders,e.RTCPeerConnection.prototype.getSenders=function(){var t=this,e=r.apply(this,[]);return e.forEach(function(e){return e._pc=t}),e},Object.defineProperty(e.RTCRtpSender.prototype,'dtmf',{get:function(){return this._dtmf===void 0&&(this.track.kind==='audio'?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}}))}function m(t){if(!t.RTCPeerConnection)return;var e=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){r=this;var r,t=Array.prototype.slice.call(arguments),n=t[0],i=t[1],a=t[2],s,o,c;return arguments.length>0&&typeof n=='function'?e.apply(this,arguments):e.length===0&&(arguments.length===0||typeof n!='function')?e.apply(this,[]):(s=function(t){var e={},n=t.result();return n.forEach(function(t){var n={id:t.id,timestamp:t.timestamp,type:{localcandidate:'local-candidate',remotecandidate:'remote-candidate'}[t.type]||t.type};t.names().forEach(function(e){n[e]=t.stat(e)}),e[n.id]=n}),e},o=function(e){return new Map(Object.keys(e).map(function(t){return[t,e[t]]}))},arguments.length>=2)?(c=function(e){i(o(s(e)))},e.apply(this,[c,n])):new Promise(function(t,n){e.apply(r,[function(e){t(o(s(e)))},n])}).then(i,a)}}function f(e){if(!((typeof e=='undefined'?'undefined':n(e))==='object'&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver))return;if(!('getStats'in e.RTCRtpSender.prototype)){var s=e.RTCPeerConnection.prototype.getSenders,o,i,a;s&&(e.RTCPeerConnection.prototype.getSenders=function(){var t=this,e=s.apply(this,[]);return e.forEach(function(e){return e._pc=t}),e}),o=e.RTCPeerConnection.prototype.addTrack,o&&(e.RTCPeerConnection.prototype.addTrack=function(){var e=o.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){var e=this;return this._pc.getStats().then(function(n){return t.filterStats(n,e.track,!0)})}}if('getStats'in e.RTCRtpReceiver.prototype||(i=e.RTCPeerConnection.prototype.getReceivers,i&&(e.RTCPeerConnection.prototype.getReceivers=function(){var t=this,e=i.apply(this,[]);return e.forEach(function(e){return e._pc=t}),e}),t.wrapPeerConnectionEvent(e,'track',function(e){return e.receiver._pc=e.srcElement,e}),e.RTCRtpReceiver.prototype.getStats=function(){var e=this;return this._pc.getStats().then(function(n){return t.filterStats(n,e.track,!1)})}),!('getStats'in e.RTCRtpSender.prototype&&'getStats'in e.RTCRtpReceiver.prototype))return;a=e.RTCPeerConnection.prototype.getStats,e.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof e.MediaStreamTrack){var s=arguments[0],t=void 0,n=void 0,o=void 0;return this.getSenders().forEach(function(e){e.track===s&&(t?o=!0:t=e)}),this.getReceivers().forEach(function(e){return e.track===s&&(n?o=!0:n=e),e.track===s}),o||t&&n?Promise.reject(new DOMException('There are more than one sender or receiver for the track.','InvalidAccessError')):t?t.getStats():n?n.getStats():Promise.reject(new DOMException('There is no sender or receiver for the track.','InvalidAccessError'))}return a.apply(this,arguments)}}function o(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){var e=this;return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(function(t){return e._shimmedLocalStreams[t][0]})};var t=e.RTCPeerConnection.prototype.addTrack,n,s,o;e.RTCPeerConnection.prototype.addTrack=function(o,e){if(!e)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};var n=t.apply(this,arguments);return this._shimmedLocalStreams[e.id]?this._shimmedLocalStreams[e.id].indexOf(n)===-1&&this._shimmedLocalStreams[e.id].push(n):this._shimmedLocalStreams[e.id]=[e,n],n},n=e.RTCPeerConnection.prototype.addStream,e.RTCPeerConnection.prototype.addStream=function(e){var t=this,s,o;this._shimmedLocalStreams=this._shimmedLocalStreams||{},e.getTracks().forEach(function(e){var n=t.getSenders().find(function(t){return t.track===e});if(n)throw new DOMException('Track already exists.','InvalidAccessError')}),s=this.getSenders(),n.apply(this,arguments),o=this.getSenders().filter(function(e){return s.indexOf(e)===-1}),this._shimmedLocalStreams[e.id]=[e].concat(o)},s=e.RTCPeerConnection.prototype.removeStream,e.RTCPeerConnection.prototype.removeStream=function(e){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[e.id],s.apply(this,arguments)},o=e.RTCPeerConnection.prototype.removeTrack,e.RTCPeerConnection.prototype.removeTrack=function(t){var e=this;return this._shimmedLocalStreams=this._shimmedLocalStreams||{},t&&Object.keys(this._shimmedLocalStreams).forEach(function(n){var s=e._shimmedLocalStreams[n].indexOf(t);s!==-1&&e._shimmedLocalStreams[n].splice(s,1),e._shimmedLocalStreams[n].length===1&&delete e._shimmedLocalStreams[n]}),o.apply(this,arguments)}}function g(e,l){if(!e.RTCPeerConnection)return;if(e.RTCPeerConnection.prototype.addTrack&&l.version>=65)return o(e);var s=e.RTCPeerConnection.prototype.getLocalStreams,a,r,n,d;e.RTCPeerConnection.prototype.getLocalStreams=function(){var e=this,t=s.apply(this);return this._reverseStreams=this._reverseStreams||{},t.map(function(t){return e._reverseStreams[t.id]})},a=e.RTCPeerConnection.prototype.addStream,e.RTCPeerConnection.prototype.addStream=function(t){var s=this,n;this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},t.getTracks().forEach(function(e){var t=s.getSenders().find(function(t){return t.track===e});if(t)throw new DOMException('Track already exists.','InvalidAccessError')}),this._reverseStreams[t.id]||(n=new e.MediaStream(t.getTracks()),this._streams[t.id]=n,this._reverseStreams[n.id]=t,t=n),a.apply(this,[t])},r=e.RTCPeerConnection.prototype.removeStream,e.RTCPeerConnection.prototype.removeStream=function(e){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},r.apply(this,[this._streams[e.id]||e]),delete this._reverseStreams[this._streams[e.id]?this._streams[e.id].id:e.id],delete this._streams[e.id]},e.RTCPeerConnection.prototype.addTrack=function(t,n){var a=this,i,r,o,s;if(this.signalingState==='closed')throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.",'InvalidStateError');if(i=[].slice.call(arguments,1),i.length!==1||!i[0].getTracks().find(function(e){return e===t}))throw new DOMException('The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.','NotSupportedError');if(r=this.getSenders().find(function(e){return e.track===t}),r)throw new DOMException('Track already exists.','InvalidAccessError');return this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},o=this._streams[n.id],o?(o.addTrack(t),Promise.resolve().then(function(){a.dispatchEvent(new Event('negotiationneeded'))})):(s=new e.MediaStream([t]),this._streams[n.id]=s,this._reverseStreams[s.id]=n,this.addStream(s)),this.getSenders().find(function(e){return e.track===t})};function t(e,n){var t=n.sdp;return Object.keys(e._reverseStreams||[]).forEach(function(s){var n=e._reverseStreams[s],o=e._streams[n.id];t=t.replace(new RegExp(o.id,'g'),n.id)}),new RTCSessionDescription({type:n.type,sdp:t})}function c(e,n){var t=n.sdp;return Object.keys(e._reverseStreams||[]).forEach(function(s){var n=e._reverseStreams[s],o=e._streams[n.id];t=t.replace(new RegExp(n.id,'g'),o.id)}),new RTCSessionDescription({type:n.type,sdp:t})}['createOffer','createAnswer'].forEach(function(n){var s=e.RTCPeerConnection.prototype[n],o=i({},n,function(){var n=this,e=arguments,o=arguments.length&&typeof arguments[0]=='function';return o?s.apply(this,[function(s){var o=t(n,s);e[0].apply(null,[o])},function(t){e[1]&&e[1].apply(null,t)},arguments[2]]):s.apply(this,arguments).then(function(e){return t(n,e)})});e.RTCPeerConnection.prototype[n]=o[n]}),n=e.RTCPeerConnection.prototype.setLocalDescription,e.RTCPeerConnection.prototype.setLocalDescription=function(){return!arguments.length||!arguments[0].type?n.apply(this,arguments):(arguments[0]=c(this,arguments[0]),n.apply(this,arguments))},d=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,'localDescription'),Object.defineProperty(e.RTCPeerConnection.prototype,'localDescription',{get:function(){var e=d.get.apply(this);return e.type===''?e:t(this,e)}}),e.RTCPeerConnection.prototype.removeTrack=function(t){var n=this,s,e;if(this.signalingState==='closed')throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.",'InvalidStateError');if(!t._pc)throw new DOMException('Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.','TypeError');if(s=t._pc===this,!s)throw new DOMException('Sender was not created by this connection.','InvalidAccessError');this._streams=this._streams||{},e=void 0,Object.keys(this._streams).forEach(function(s){var o=n._streams[s].getTracks().find(function(e){return t.track===e});o&&(e=n._streams[s])}),e&&(e.getTracks().length===1?this.removeStream(this._reverseStreams[e.id]):e.removeTrack(t.track),this.dispatchEvent(new Event('negotiationneeded')))}}function p(e,t){if(!e.RTCPeerConnection&&e.webkitRTCPeerConnection&&(e.RTCPeerConnection=e.webkitRTCPeerConnection),!e.RTCPeerConnection)return;53>t.version&&['setLocalDescription','setRemoteDescription','addIceCandidate'].forEach(function(t){var n=e.RTCPeerConnection.prototype[t],s=i({},t,function(){return arguments[0]=new(t==='addIceCandidate'?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),n.apply(this,arguments)});e.RTCPeerConnection.prototype[t]=s[t]})}function v(e,n){t.wrapPeerConnectionEvent(e,'negotiationneeded',function(t){var e=t.target;if(72>n.version||e.getConfiguration&&e.getConfiguration().sdpSemantics==='plan-b')if(e.signalingState!=='stable')return;return t})}},{"../utils.js":11,"./getdisplaymedia":4,"./getusermedia":5}],4:[function(n,s,e){'use strict';Object.defineProperty(e,"__esModule",{value:!0}),e.shimGetDisplayMedia=t;function t(e,t){if(e.navigator.mediaDevices&&'getDisplayMedia'in e.navigator.mediaDevices)return;if(!e.navigator.mediaDevices)return;if(typeof t!='function'){console.error('shimGetDisplayMedia: getSourceId argument is not a function');return}e.navigator.mediaDevices.getDisplayMedia=function(n){return t(n).then(function(o){var t=n.video&&n.video.width,s=n.video&&n.video.height,i=n.video&&n.video.frameRate;return n.video={mandatory:{chromeMediaSource:'desktop',chromeMediaSourceId:o,maxFrameRate:i||3}},t&&(n.video.mandatory.maxWidth=t),s&&(n.video.mandatory.maxHeight=s),e.navigator.mediaDevices.getUserMedia(n)})}}},{}],5:[function(s,c,n){'use strict';Object.defineProperty(n,"__esModule",{value:!0});var e=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o,i,t;n.shimGetUserMedia=r,o=s('../utils.js'),i=a(o);function a(e){if(e&&e.__esModule)return e;var t={},n;if(e!=null)for(n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}t=i.log;function r(i,s){var n=i&&i.navigator,o,a,r,c,l;if(!n.mediaDevices)return;o=function(n){if((typeof n=='undefined'?'undefined':e(n))!=='object'||n.mandatory||n.optional)return n;var t={};return Object.keys(n).forEach(function(o){if(o==='require'||o==='advanced'||o==='mediaSource')return;var s=e(n[o])==='object'?n[o]:{ideal:n[o]},a,i;s.exact!==void 0&&typeof s.exact=='number'&&(s.min=s.max=s.exact),a=function(t,e){return t?t+e.charAt(0).toUpperCase()+e.slice(1):e==='deviceId'?'sourceId':e},s.ideal!==void 0&&(t.optional=t.optional||[],i={},typeof s.ideal=='number'?(i[a('min',o)]=s.ideal,t.optional.push(i),i={},i[a('max',o)]=s.ideal,t.optional.push(i)):(i[a('',o)]=s.ideal,t.optional.push(i))),s.exact!==void 0&&typeof s.exact!='number'?(t.mandatory=t.mandatory||{},t.mandatory[a('',o)]=s.exact):['min','max'].forEach(function(e){s[e]!==void 0&&(t.mandatory=t.mandatory||{},t.mandatory[a(e,o)]=s[e])})}),n.advanced&&(t.optional=(t.optional||[]).concat(n.advanced)),t},a=function(i,c){if(s.version>=61)return c(i);if(i=JSON.parse(JSON.stringify(i)),i&&e(i.audio)==='object'){var l=function(e,t,n){t in e&&!(n in e)&&(e[n]=e[t],delete e[t])},a,d,r;i=JSON.parse(JSON.stringify(i)),l(i.audio,'autoGainControl','googAutoGainControl'),l(i.audio,'noiseSuppression','googNoiseSuppression'),i.audio=o(i.audio)}if(i&&e(i.video)==='object'){if(a=i.video.facingMode,a=a&&((typeof a=='undefined'?'undefined':e(a))==='object'?a:{ideal:a}),d=66>s.version,a&&(a.exact==='user'||a.exact==='environment'||a.ideal==='user'||a.ideal==='environment')&&!(n.mediaDevices.getSupportedConstraints&&n.mediaDevices.getSupportedConstraints().facingMode&&!d))if(delete i.video.facingMode,r=void 0,a.exact==='environment'||a.ideal==='environment'?r=['back','rear']:(a.exact==='user'||a.ideal==='user')&&(r=['front']),r)return n.mediaDevices.enumerateDevices().then(function(e){e=e.filter(function(e){return e.kind==='videoinput'});var n=e.find(function(e){return r.some(function(t){return e.label.toLowerCase().includes(t)})});return!n&&e.length&&r.includes('back')&&(n=e[e.length-1]),n&&(i.video.deviceId=a.exact?{exact:n.deviceId}:{ideal:n.deviceId}),i.video=o(i.video),t('chrome: '+JSON.stringify(i)),c(i)});i.video=o(i.video)}return t('chrome: '+JSON.stringify(i)),c(i)},r=function(e){return s.version>=64?e:{name:{PermissionDeniedError:'NotAllowedError',PermissionDismissedError:'NotAllowedError',InvalidStateError:'NotAllowedError',DevicesNotFoundError:'NotFoundError',ConstraintNotSatisfiedError:'OverconstrainedError',TrackStartError:'NotReadableError',MediaDeviceFailedDueToShutdown:'NotAllowedError',MediaDeviceKillSwitchOn:'NotAllowedError',TabCaptureError:'AbortError',ScreenCaptureError:'AbortError',DeviceCaptureError:'AbortError'}[e.name]||e.name,message:e.message,constraint:e.constraint||e.constraintName,toString:function(){return this.name+(this.message&&': ')+this.message}}},c=function(t,s,e){a(t,function(t){n.webkitGetUserMedia(t,s,function(t){e&&e(r(t))})})},n.getUserMedia=c.bind(n),n.mediaDevices.getUserMedia&&(l=n.mediaDevices.getUserMedia.bind(n.mediaDevices),n.mediaDevices.getUserMedia=function(e){return a(e,function(e){return l(e).then(function(t){if(e.audio&&!t.getAudioTracks().length||e.video&&!t.getVideoTracks().length)throw t.getTracks().forEach(function(e){e.stop()}),new DOMException('','NotFoundError');return t},function(e){return Promise.reject(r(e))})})})}},{"../utils.js":11}],6:[function(n,g,e){'use strict';Object.defineProperty(e,"__esModule",{value:!0});var s=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r,t,a,o;e.shimRTCIceCandidate=d,e.shimMaxMessageSize=u,e.shimSendThrowTypeError=h,e.shimConnectionState=m,e.removeExtmapAllowMixed=f,e.shimAddIceCandidateNullOrEmpty=c,e.shimParameterlessSetLocalDescription=p,r=n('sdp'),t=l(r),a=n('./utils'),o=i(a);function i(e){if(e&&e.__esModule)return e;var t={},n;if(e!=null)for(n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function l(e){return e&&e.__esModule?e:{default:e}}function d(e){if(!e.RTCIceCandidate||e.RTCIceCandidate&&'foundation'in e.RTCIceCandidate.prototype)return;var n=e.RTCIceCandidate;e.RTCIceCandidate=function(e){if((typeof e=='undefined'?'undefined':s(e))==='object'&&e.candidate&&e.candidate.indexOf('a=')===0&&(e=JSON.parse(JSON.stringify(e)),e.candidate=e.candidate.substr(2)),e.candidate&&e.candidate.length){var i=new n(e),a=t.default.parseCandidate(e.candidate),o=Object.assign(i,a);return o.toJSON=function(){return{candidate:o.candidate,sdpMid:o.sdpMid,sdpMLineIndex:o.sdpMLineIndex,usernameFragment:o.usernameFragment}},o}return new n(e)},e.RTCIceCandidate.prototype=n.prototype,o.wrapPeerConnectionEvent(e,'icecandidate',function(t){return t.candidate&&Object.defineProperty(t,'candidate',{value:new e.RTCIceCandidate(t.candidate),writable:'false'}),t})}function u(n,e){if(!n.RTCPeerConnection)return;'sctp'in n.RTCPeerConnection.prototype||Object.defineProperty(n.RTCPeerConnection.prototype,'sctp',{get:function(){return typeof this._sctp=='undefined'?null:this._sctp}});var s=function(e){if(!e||!e.sdp)return!1;var n=t.default.splitSections(e.sdp);return n.shift(),n.some(function(n){var e=t.default.parseMLine(n);return e&&e.kind==='application'&&e.protocol.indexOf('SCTP')!==-1})},o=function(n){var e=n.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/),t;return e===null||2>e.length?-1:(t=parseInt(e[1],10),t!==t?-1:t)},i=function(n){var t=65536;return e.browser==='firefox'&&(57>e.version?n===-1?t=16384:t=2147483637:60>e.version?t=e.version===57?65535:65536:t=2147483637),t},a=function(o,i){var n=65536,s;return e.browser==='firefox'&&e.version===57&&(n=65535),s=t.default.matchPrefix(o.sdp,'a=max-message-size:'),s.length>0?n=parseInt(s[0].substr(19),10):e.browser==='firefox'&&i!==-1&&(n=2147483637),n},r=n.RTCPeerConnection.prototype.setRemoteDescription;n.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,e.browser==='chrome'&&e.version>=76){var h=this.getConfiguration(),u=h.sdpSemantics,d,n,c,t,l;u==='plan-b'&&Object.defineProperty(this,'sctp',{get:function(){return typeof this._sctp=='undefined'?null:this._sctp},enumerable:!0,configurable:!0})}return s(arguments[0])&&(d=o(arguments[0]),n=i(d),c=a(arguments[0],d),t=void 0,n===0&&c===0?t=Number.POSITIVE_INFINITY:n===0||c===0?t=Math.max(n,c):t=Math.min(n,c),l={},Object.defineProperty(l,'maxMessageSize',{get:function(){return t}}),this._sctp=l),r.apply(this,arguments)}}function h(e){if(!(e.RTCPeerConnection&&'createDataChannel'in e.RTCPeerConnection.prototype))return;function t(e,t){var n=e.send;e.send=function(){var s=arguments[0],o=s.length||s.size||s.byteLength;if(e.readyState==='open'&&t.sctp&&o>t.sctp.maxMessageSize)throw new TypeError('Message too large (can send a maximum of '+t.sctp.maxMessageSize+' bytes)');return n.apply(e,arguments)}}var n=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){var e=n.apply(this,arguments);return t(e,this),e},o.wrapPeerConnectionEvent(e,'datachannel',function(e){return t(e.channel,e.target),e})}function m(t){if(!t.RTCPeerConnection||'connectionState'in t.RTCPeerConnection.prototype)return;var e=t.RTCPeerConnection.prototype;Object.defineProperty(e,'connectionState',{get:function(){return{completed:'connected',checking:'connecting'}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(e,'onconnectionstatechange',{get:function(){return this._onconnectionstatechange||null},set:function(e){this._onconnectionstatechange&&(this.removeEventListener('connectionstatechange',this._onconnectionstatechange),delete this._onconnectionstatechange),e&&this.addEventListener('connectionstatechange',this._onconnectionstatechange=e)},enumerable:!0,configurable:!0}),['setLocalDescription','setRemoteDescription'].forEach(function(t){var n=e[t];e[t]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=function(t){var e=t.target,n;return e._lastConnectionState!==e.connectionState&&(e._lastConnectionState=e.connectionState,n=new Event('connectionstatechange',t),e.dispatchEvent(n)),t},this.addEventListener('iceconnectionstatechange',this._connectionstatechangepoly)),n.apply(this,arguments)}})}function f(e,t){if(!e.RTCPeerConnection)return;if(t.browser==='chrome'&&t.version>=71)return;if(t.browser==='safari'&&t.version>=605)return;var n=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(t){if(t&&t.sdp&&t.sdp.indexOf('\na=extmap-allow-mixed')!==-1){var s=t.sdp.split('\n').filter(function(e){return e.trim()!=='a=extmap-allow-mixed'}).join('\n');e.RTCSessionDescription&&t instanceof e.RTCSessionDescription?arguments[0]=new e.RTCSessionDescription({type:t.type,sdp:s}):t.sdp=s}return n.apply(this,arguments)}}function c(t,e){if(!(t.RTCPeerConnection&&t.RTCPeerConnection.prototype))return;var n=t.RTCPeerConnection.prototype.addIceCandidate;if(!n||n.length===0)return;t.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(e.browser==='chrome'&&78>e.version||e.browser==='firefox'&&68>e.version||e.browser==='safari')&&arguments[0]&&arguments[0].candidate===''?Promise.resolve():n.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())}}function p(t){if(!(t.RTCPeerConnection&&t.RTCPeerConnection.prototype))return;var e=t.RTCPeerConnection.prototype.setLocalDescription;if(!e||e.length===0)return;t.RTCPeerConnection.prototype.setLocalDescription=function(){var n=this,o,t=arguments[0]||{};if((typeof t=='undefined'?'undefined':s(t))!=='object'||t.type&&t.sdp)return e.apply(this,arguments);if(t={type:t.type,sdp:t.sdp},!t.type)switch(this.signalingState){case'stable':case'have-local-offer':case'have-remote-pranswer':t.type='offer';break;default:t.type='answer';break}return t.sdp||t.type!=='offer'&&t.type!=='answer'?e.apply(this,[t]):(o=t.type==='offer'?this.createOffer:this.createAnswer,o.apply(this).then(function(t){return e.apply(n,[t])}))}}},{"./utils":11,sdp:12}],7:[function(n,j,e){'use strict';Object.defineProperty(e,"__esModule",{value:!0}),e.shimGetDisplayMedia=e.shimGetUserMedia=void 0;var t=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i,a,s,r=n('./getusermedia');Object.defineProperty(e,'shimGetUserMedia',{enumerable:!0,get:function(){return r.shimGetUserMedia}}),i=n('./getdisplaymedia'),Object.defineProperty(e,'shimGetDisplayMedia',{enumerable:!0,get:function(){return i.shimGetDisplayMedia}}),e.shimOnTrack=o,e.shimPeerConnection=u,e.shimSenderGetStats=h,e.shimReceiverGetStats=m,e.shimRemoveStream=f,e.shimRTCDataChannel=p,e.shimAddTransceiver=g,e.shimGetParameters=v,e.shimCreateOffer=d,e.shimCreateAnswer=b,a=n('../utils'),s=c(a);function c(e){if(e&&e.__esModule)return e;var t={},n;if(e!=null)for(n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function l(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e){(typeof e=='undefined'?'undefined':t(e))==='object'&&e.RTCTrackEvent&&'receiver'in e.RTCTrackEvent.prototype&&!('transceiver'in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,'transceiver',{get:function(){return{receiver:this.receiver}}})}function u(e,n){if((typeof e=='undefined'?'undefined':t(e))!=='object'||!(e.RTCPeerConnection||e.mozRTCPeerConnection))return;!e.RTCPeerConnection&&e.mozRTCPeerConnection&&(e.RTCPeerConnection=e.mozRTCPeerConnection),53>n.version&&['setLocalDescription','setRemoteDescription','addIceCandidate'].forEach(function(t){var n=e.RTCPeerConnection.prototype[t],s=l({},t,function(){return arguments[0]=new(t==='addIceCandidate'?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),n.apply(this,arguments)});e.RTCPeerConnection.prototype[t]=s[t]});var s={inboundrtp:'inbound-rtp',outboundrtp:'outbound-rtp',candidatepair:'candidate-pair',localcandidate:'local-candidate',remotecandidate:'remote-candidate'},o=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){var e=Array.prototype.slice.call(arguments),i=e[0],t=e[1],a=e[2];return o.apply(this,[i||null]).then(function(e){if(53>n.version&&!t)try{e.forEach(function(e){e.type=s[e.type]||e.type})}catch(t){if(t.name!=='TypeError')throw t;e.forEach(function(t,n){e.set(n,Object.assign({},t,{type:s[t.type]||t.type}))})}return e}).then(t,a)}}function h(e){if(!((typeof e=='undefined'?'undefined':t(e))==='object'&&e.RTCPeerConnection&&e.RTCRtpSender))return;if(e.RTCRtpSender&&'getStats'in e.RTCRtpSender.prototype)return;var n=e.RTCPeerConnection.prototype.getSenders,s;n&&(e.RTCPeerConnection.prototype.getSenders=function(){var t=this,e=n.apply(this,[]);return e.forEach(function(e){return e._pc=t}),e}),s=e.RTCPeerConnection.prototype.addTrack,s&&(e.RTCPeerConnection.prototype.addTrack=function(){var e=s.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function m(e){if(!((typeof e=='undefined'?'undefined':t(e))==='object'&&e.RTCPeerConnection&&e.RTCRtpSender))return;if(e.RTCRtpSender&&'getStats'in e.RTCRtpReceiver.prototype)return;var n=e.RTCPeerConnection.prototype.getReceivers;n&&(e.RTCPeerConnection.prototype.getReceivers=function(){var t=this,e=n.apply(this,[]);return e.forEach(function(e){return e._pc=t}),e}),s.wrapPeerConnectionEvent(e,'track',function(e){return e.receiver._pc=e.srcElement,e}),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function f(e){if(!e.RTCPeerConnection||'removeStream'in e.RTCPeerConnection.prototype)return;e.RTCPeerConnection.prototype.removeStream=function(e){var t=this;s.deprecated('removeStream','removeTrack'),this.getSenders().forEach(function(n){n.track&&e.getTracks().includes(n.track)&&t.removeTrack(n)})}}function p(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)}function g(e){if(!((typeof e=='undefined'?'undefined':t(e))==='object'&&e.RTCPeerConnection))return;var n=e.RTCPeerConnection.prototype.addTransceiver;n&&(e.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];var e=arguments[1],i,t,s,o=e&&'sendEncodings'in e;return o&&e.sendEncodings.forEach(function(e){if('rid'in e){var t=/^[a-z0-9]{0,16}$/i;if(!t.test(e.rid))throw new TypeError('Invalid RID value provided.')}if('scaleResolutionDownBy'in e)if(!(parseFloat(e.scaleResolutionDownBy)>=1))throw new RangeError('scale_resolution_down_by must be >= 1.0');if('maxFramerate'in e)if(!(parseFloat(e.maxFramerate)>=0))throw new RangeError('max_framerate must be >= 0.0')}),i=n.apply(this,arguments),o&&(t=i.sender,s=t.getParameters(),(!('encodings'in s)||s.encodings.length===1&&Object.keys(s.encodings[0]).length===0)&&(s.encodings=e.sendEncodings,t.sendEncodings=e.sendEncodings,this.setParametersPromises.push(t.setParameters(s).then(function(){delete t.sendEncodings}).catch(function(){delete t.sendEncodings})))),i})}function v(e){if(!((typeof e=='undefined'?'undefined':t(e))==='object'&&e.RTCRtpSender))return;var n=e.RTCRtpSender.prototype.getParameters;n&&(e.RTCRtpSender.prototype.getParameters=function(){var e=n.apply(this,arguments);return'encodings'in e||(e.encodings=[].concat(this.sendEncodings||[{}])),e})}function d(e){if(!((typeof e=='undefined'?'undefined':t(e))==='object'&&e.RTCPeerConnection))return;var n=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(){var e=this,t=arguments;return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(function(){return n.apply(e,t)}).finally(function(){e.setParametersPromises=[]}):n.apply(this,arguments)}}function b(e){if(!((typeof e=='undefined'?'undefined':t(e))==='object'&&e.RTCPeerConnection))return;var n=e.RTCPeerConnection.prototype.createAnswer;e.RTCPeerConnection.prototype.createAnswer=function(){var e=this,t=arguments;return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(function(){return n.apply(e,t)}).finally(function(){e.setParametersPromises=[]}):n.apply(this,arguments)}}},{"../utils":11,"./getdisplaymedia":8,"./getusermedia":9}],8:[function(n,s,e){'use strict';Object.defineProperty(e,"__esModule",{value:!0}),e.shimGetDisplayMedia=t;function t(e,t){if(e.navigator.mediaDevices&&'getDisplayMedia'in e.navigator.mediaDevices)return;if(!e.navigator.mediaDevices)return;e.navigator.mediaDevices.getDisplayMedia=function(n){if(!(n&&n.video)){var s=new DOMException('getDisplayMedia without video constraints is undefined');return s.name='NotFoundError',s.code=8,Promise.reject(s)}return n.video===!0?n.video={mediaSource:t}:n.video.mediaSource=t,e.navigator.mediaDevices.getUserMedia(n)}}},{}],9:[function(n,r,t){'use strict';Object.defineProperty(t,"__esModule",{value:!0});var e=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o,i;t.shimGetUserMedia=s,o=n('../utils'),i=a(o);function a(e){if(e&&e.__esModule)return e;var t={},n;if(e!=null)for(n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function s(o,a){var n=o&&o.navigator,s,r,c,l,t=o&&o.MediaStreamTrack;n.getUserMedia=function(e,t,s){i.deprecated('navigator.getUserMedia','navigator.mediaDevices.getUserMedia'),n.mediaDevices.getUserMedia(e).then(t,s)},a.version>55&&'autoGainControl'in n.mediaDevices.getSupportedConstraints()||(s=function(e,t,n){t in e&&!(n in e)&&(e[n]=e[t],delete e[t])},r=n.mediaDevices.getUserMedia.bind(n.mediaDevices),n.mediaDevices.getUserMedia=function(t){return(typeof t=='undefined'?'undefined':e(t))==='object'&&e(t.audio)==='object'&&(t=JSON.parse(JSON.stringify(t)),s(t.audio,'autoGainControl','mozAutoGainControl'),s(t.audio,'noiseSuppression','mozNoiseSuppression')),r(t)},t&&t.prototype.getSettings&&(c=t.prototype.getSettings,t.prototype.getSettings=function(){var e=c.apply(this,arguments);return s(e,'mozAutoGainControl','autoGainControl'),s(e,'mozNoiseSuppression','noiseSuppression'),e}),t&&t.prototype.applyConstraints&&(l=t.prototype.applyConstraints,t.prototype.applyConstraints=function(t){return this.kind==='audio'&&(typeof t=='undefined'?'undefined':e(t))==='object'&&(t=JSON.parse(JSON.stringify(t)),s(t,'autoGainControl','mozAutoGainControl'),s(t,'noiseSuppression','mozNoiseSuppression')),l.apply(this,[t])}))}},{"../utils":11}],10:[function(o,p,e){'use strict';Object.defineProperty(e,"__esModule",{value:!0});var t=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i,n;e.shimLocalStreamsAPI=r,e.shimRemoteStreamsAPI=c,e.shimCallbacksAPI=l,e.shimGetUserMedia=d,e.shimConstraints=s,e.shimRTCIceServerUrls=h,e.shimTrackEventTransceiver=m,e.shimCreateOfferLegacy=u,e.shimAudioContext=f,i=o('../utils'),n=a(i);function a(e){if(e&&e.__esModule)return e;var t={},n;if(e!=null)for(n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function r(e){if((typeof e=='undefined'?'undefined':t(e))!=='object'||!e.RTCPeerConnection)return;if('getLocalStreams'in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!('addStream'in e.RTCPeerConnection.prototype)){var n=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(e){var t=this;this._localStreams||(this._localStreams=[]),this._localStreams.includes(e)||this._localStreams.push(e),e.getAudioTracks().forEach(function(s){return n.call(t,s,e)}),e.getVideoTracks().forEach(function(s){return n.call(t,s,e)})},e.RTCPeerConnection.prototype.addTrack=function(){e=this;for(var e,s=arguments.length,o=Array(s>1?s-1:0),t=1;s>t;t++)o[t-1]=arguments[t];return o&&o.forEach(function(t){e._localStreams?e._localStreams.includes(t)||e._localStreams.push(t):e._localStreams=[t]}),n.apply(this,arguments)}}'removeStream'in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(e){var n=this,t,s;if(this._localStreams||(this._localStreams=[]),t=this._localStreams.indexOf(e),t===-1)return;this._localStreams.splice(t,1),s=e.getTracks(),this.getSenders().forEach(function(e){s.includes(e.track)&&n.removeTrack(e)})})}function c(e){if((typeof e=='undefined'?'undefined':t(e))!=='object'||!e.RTCPeerConnection)return;if('getRemoteStreams'in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!('onaddstream'in e.RTCPeerConnection.prototype)){Object.defineProperty(e.RTCPeerConnection.prototype,'onaddstream',{get:function(){return this._onaddstream},set:function(t){var e=this;this._onaddstream&&(this.removeEventListener('addstream',this._onaddstream),this.removeEventListener('track',this._onaddstreampoly)),this.addEventListener('addstream',this._onaddstream=t),this.addEventListener('track',this._onaddstreampoly=function(t){t.streams.forEach(function(t){if(e._remoteStreams||(e._remoteStreams=[]),e._remoteStreams.includes(t))return;e._remoteStreams.push(t);var n=new Event('addstream');n.stream=t,e.dispatchEvent(n)})})}});var n=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){var e=this;return this._onaddstreampoly||this.addEventListener('track',this._onaddstreampoly=function(t){t.streams.forEach(function(t){if(e._remoteStreams||(e._remoteStreams=[]),e._remoteStreams.indexOf(t)>=0)return;e._remoteStreams.push(t);var n=new Event('addstream');n.stream=t,e.dispatchEvent(n)})}),n.apply(e,arguments)}}}function l(s){if((typeof s=='undefined'?'undefined':t(s))!=='object'||!s.RTCPeerConnection)return;var e=s.RTCPeerConnection.prototype,n,o=e.createOffer,i=e.createAnswer,a=e.setLocalDescription,r=e.setRemoteDescription,c=e.addIceCandidate;e.createOffer=function(n,e){var s=arguments.length>=2?arguments[2]:arguments[0],t=o.apply(this,[s]);return e?(t.then(n,e),Promise.resolve()):t},e.createAnswer=function(n,e){var s=arguments.length>=2?arguments[2]:arguments[0],t=i.apply(this,[s]);return e?(t.then(n,e),Promise.resolve()):t},n=function(n,s,e){var t=a.apply(this,[n]);return e?(t.then(s,e),Promise.resolve()):t},e.setLocalDescription=n,n=function(n,s,e){var t=r.apply(this,[n]);return e?(t.then(s,e),Promise.resolve()):t},e.setRemoteDescription=n,n=function(n,s,e){var t=c.apply(this,[n]);return e?(t.then(s,e),Promise.resolve()):t},e.addIceCandidate=n}function d(t){var e=t&&t.navigator,n,o;e.mediaDevices&&e.mediaDevices.getUserMedia&&(n=e.mediaDevices,o=n.getUserMedia.bind(n),e.mediaDevices.getUserMedia=function(e){return o(s(e))}),!e.getUserMedia&&e.mediaDevices&&e.mediaDevices.getUserMedia&&(e.getUserMedia=function(t,n,s){e.mediaDevices.getUserMedia(t).then(n,s)}.bind(e))}function s(e){return e&&e.video!==void 0?Object.assign({},e,{video:n.compactObject(e.video)}):e}function h(e){if(!e.RTCPeerConnection)return;var t=e.RTCPeerConnection;e.RTCPeerConnection=function(s,a){if(s&&s.iceServers){for(var i=[],e,o=0;s.iceServers.length>o;o++)e=s.iceServers[o],!e.hasOwnProperty('urls')&&e.hasOwnProperty('url')?(n.deprecated('RTCIceServer.url','RTCIceServer.urls'),e=JSON.parse(JSON.stringify(e)),e.urls=e.url,delete e.url,i.push(e)):i.push(s.iceServers[o]);s.iceServers=i}return new t(s,a)},e.RTCPeerConnection.prototype=t.prototype,'generateCertificate'in t&&Object.defineProperty(e.RTCPeerConnection,'generateCertificate',{get:function(){return t.generateCertificate}})}function m(e){(typeof e=='undefined'?'undefined':t(e))==='object'&&e.RTCTrackEvent&&'receiver'in e.RTCTrackEvent.prototype&&!('transceiver'in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,'transceiver',{get:function(){return{receiver:this.receiver}}})}function u(e){var t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(e){if(e){typeof e.offerToReceiveAudio!='undefined'&&(e.offerToReceiveAudio=!!e.offerToReceiveAudio);var n=this.getTransceivers().find(function(e){return e.receiver.track.kind==='audio'}),s;e.offerToReceiveAudio===!1&&n?n.direction==='sendrecv'?n.setDirection?n.setDirection('sendonly'):n.direction='sendonly':n.direction==='recvonly'&&(n.setDirection?n.setDirection('inactive'):n.direction='inactive'):e.offerToReceiveAudio===!0&&!n&&this.addTransceiver('audio'),typeof e.offerToReceiveVideo!='undefined'&&(e.offerToReceiveVideo=!!e.offerToReceiveVideo),s=this.getTransceivers().find(function(e){return e.receiver.track.kind==='video'}),e.offerToReceiveVideo===!1&&s?s.direction==='sendrecv'?s.setDirection?s.setDirection('sendonly'):s.direction='sendonly':s.direction==='recvonly'&&(s.setDirection?s.setDirection('inactive'):s.direction='inactive'):e.offerToReceiveVideo===!0&&!s&&this.addTransceiver('video')}return t.apply(this,arguments)}}function f(e){if((typeof e=='undefined'?'undefined':t(e))!=='object'||e.AudioContext)return;e.AudioContext=e.webkitAudioContext}},{"../utils":11}],11:[function(v,g,e){'use strict';Object.defineProperty(e,"__esModule",{value:!0});var s=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a,r;e.extractVersion=n,e.wrapPeerConnectionEvent=f,e.disableLog=l,e.disableWarnings=d,e.log=u,e.deprecated=h,e.detectBrowser=m,e.compactObject=i,e.walkStats=t,e.filterStats=c;function p(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}a=!0,r=!0;function n(n,s,t){var e=n.match(s);return e&&e.length>=t&&parseInt(e[t],10)}function f(s,e,i){if(!s.RTCPeerConnection)return;var t=s.RTCPeerConnection.prototype,n,o=t.addEventListener;t.addEventListener=function(n,t){if(n!==e)return o.apply(this,arguments);var s=function(n){var e=i(n);e&&(t.handleEvent?t.handleEvent(e):t(e))};return this._eventMap=this._eventMap||{},this._eventMap[e]||(this._eventMap[e]=new Map),this._eventMap[e].set(t,s),o.apply(this,[n,s])},n=t.removeEventListener,t.removeEventListener=function(s,t){if(s!==e||!this._eventMap||!this._eventMap[e])return n.apply(this,arguments);if(!this._eventMap[e].has(t))return n.apply(this,arguments);var o=this._eventMap[e].get(t);return this._eventMap[e].delete(t),this._eventMap[e].size===0&&delete this._eventMap[e],Object.keys(this._eventMap).length===0&&delete this._eventMap,n.apply(this,[s,o])},Object.defineProperty(t,'on'+e,{get:function(){return this['_on'+e]},set:function(t){this['_on'+e]&&(this.removeEventListener(e,this['_on'+e]),delete this['_on'+e]),t&&this.addEventListener(e,this['_on'+e]=t)},enumerable:!0,configurable:!0})}function l(e){return typeof e!='boolean'?new Error('Argument type: '+(typeof e=='undefined'?'undefined':s(e))+'. Please use a boolean.'):(a=e,e?'adapter.js logging disabled':'adapter.js logging enabled')}function d(e){return typeof e!='boolean'?new Error('Argument type: '+(typeof e=='undefined'?'undefined':s(e))+'. Please use a boolean.'):(r=!e,'adapter.js deprecation warnings '+(e?'disabled':'enabled'))}function u(){if((typeof window=='undefined'?'undefined':s(window))==='object'){if(a)return;typeof console!='undefined'&&typeof console.log=='function'&&console.log.apply(console,arguments)}}function h(e,t){if(!r)return;console.warn(e+' is deprecated, please use '+t+' instead.')}function m(t){var e={browser:null,version:null},s;if(typeof t=='undefined'||!t.navigator)return e.browser='Not a browser.',e;if(s=t.navigator,s.mozGetUserMedia)e.browser='firefox',e.version=n(s.userAgent,/Firefox\/(\d+)\./,1);else if(s.webkitGetUserMedia||t.isSecureContext===!1&&t.webkitRTCPeerConnection&&!t.RTCIceGatherer)e.browser='chrome',e.version=n(s.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else if(t.RTCPeerConnection&&s.userAgent.match(/AppleWebKit\/(\d+)\./))e.browser='safari',e.version=n(s.userAgent,/AppleWebKit\/(\d+)\./,1),e.supportsUnifiedPlan=t.RTCRtpTransceiver&&'currentDirection'in t.RTCRtpTransceiver.prototype;else return e.browser='Not a supported browser.',e;return e}function o(e){return Object.prototype.toString.call(e)==='[object Object]'}function i(e){return o(e)?Object.keys(e).reduce(function(s,t){var a=o(e[t]),n=a?i(e[t]):e[t],r=a&&!Object.keys(n).length;return n===void 0||r?s:Object.assign(s,p({},t,n))},{}):e}function t(n,e,s){if(!e||s.has(e.id))return;s.set(e.id,e),Object.keys(e).forEach(function(o){o.endsWith('Id')?t(n,n.get(e[o]),s):o.endsWith('Ids')&&e[o].forEach(function(e){t(n,n.get(e),s)})})}function c(e,s,i){var a=i?'outbound-rtp':'inbound-rtp',o,n=new Map;return s===null?n:(o=[],e.forEach(function(e){e.type==='track'&&e.trackIdentifier===s.id&&o.push(e)}),o.forEach(function(s){e.forEach(function(o){o.type===a&&o.trackId===s.id&&t(e,o,n)})}),n)}},{}],12:[function(s,t){'use strict';var n=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e={};e.generateIdentifier=function(){return Math.random().toString(36).substr(2,10)},e.localCName=e.generateIdentifier(),e.splitLines=function(e){return e.trim().split('\n').map(function(e){return e.trim()})},e.splitSections=function(e){var t=e.split('\nm=');return t.map(function(e,t){return(t>0?'m='+e:e).trim()+'\r\n'})},e.getDescription=function(n){var t=e.splitSections(n);return t&&t[0]},e.getMediaSections=function(n){var t=e.splitSections(n);return t.shift(),t},e.matchPrefix=function(t,n){return e.splitLines(t).filter(function(e){return e.indexOf(n)===0})},e.parseCandidate=function(s){var e=void 0,n,t;s.indexOf('a=candidate:')===0?e=s.substring(12).split(' '):e=s.substring(10).split(' '),n={foundation:e[0],component:{1:'rtp',2:'rtcp'}[e[1]]||e[1],protocol:e[2].toLowerCase(),priority:parseInt(e[3],10),ip:e[4],address:e[4],port:parseInt(e[5],10),type:e[7]};for(t=8;e.length>t;t+=2)switch(e[t]){case'raddr':n.relatedAddress=e[t+1];break;case'rport':n.relatedPort=parseInt(e[t+1],10);break;case'tcptype':n.tcpType=e[t+1];break;case'ufrag':n.ufrag=e[t+1],n.usernameFragment=e[t+1];break;default:n[e[t]]===void 0&&(n[e[t]]=e[t+1]);break}return n},e.writeCandidate=function(e){var t=[],n,s;return t.push(e.foundation),n=e.component,n==='rtp'?t.push(1):n==='rtcp'?t.push(2):t.push(n),t.push(e.protocol.toUpperCase()),t.push(e.priority),t.push(e.address||e.ip),t.push(e.port),s=e.type,t.push('typ'),t.push(s),s!=='host'&&e.relatedAddress&&e.relatedPort&&(t.push('raddr'),t.push(e.relatedAddress),t.push('rport'),t.push(e.relatedPort)),e.tcpType&&e.protocol.toLowerCase()==='tcp'&&(t.push('tcptype'),t.push(e.tcpType)),(e.usernameFragment||e.ufrag)&&(t.push('ufrag'),t.push(e.usernameFragment||e.ufrag)),'candidate:'+t.join(' ')},e.parseIceOptions=function(e){return e.substr(14).split(' ')},e.parseRtpMap=function(n){var e=n.substr(9).split(' '),t={payloadType:parseInt(e.shift(),10)};return e=e[0].split('/'),t.name=e[0],t.clockRate=parseInt(e[1],10),t.channels=e.length===3?parseInt(e[2],10):1,t.numChannels=t.channels,t},e.writeRtpMap=function(e){var t=e.payloadType,n;return e.preferredPayloadType!==void 0&&(t=e.preferredPayloadType),n=e.channels||e.numChannels||1,'a=rtpmap:'+t+' '+e.name+'/'+e.clockRate+(n!==1?'/'+n:'')+'\r\n'},e.parseExtmap=function(t){var e=t.substr(9).split(' ');return{id:parseInt(e[0],10),direction:e[0].indexOf('/')>0?e[0].split('/')[1]:'sendrecv',uri:e[1]}},e.writeExtmap=function(e){return'a=extmap:'+(e.id||e.preferredId)+(e.direction&&e.direction!=='sendrecv'?'/'+e.direction:'')+' '+e.uri+'\r\n'},e.parseFmtp=function(n){for(var s={},e=void 0,o=n.substr(n.indexOf(' ')+1).split(';'),t=0;o.length>t;t++)e=o[t].trim().split('='),s[e[0].trim()]=e[1];return s},e.writeFmtp=function(e){var n='',t,s=e.payloadType;return e.preferredPayloadType!==void 0&&(s=e.preferredPayloadType),e.parameters&&Object.keys(e.parameters).length&&(t=[],Object.keys(e.parameters).forEach(function(n){e.parameters[n]!==void 0?t.push(n+'='+e.parameters[n]):t.push(n)}),n+='a=fmtp:'+s+' '+t.join(';')+'\r\n'),n},e.parseRtcpFb=function(e){var t=e.substr(e.indexOf(' ')+1).split(' ');return{type:t.shift(),parameter:t.join(' ')}},e.writeRtcpFb=function(e){var t='',n=e.payloadType;return e.preferredPayloadType!==void 0&&(n=e.preferredPayloadType),e.rtcpFeedback&&e.rtcpFeedback.length&&e.rtcpFeedback.forEach(function(e){t+='a=rtcp-fb:'+n+' '+e.type+(e.parameter&&e.parameter.length?' '+e.parameter:'')+'\r\n'}),t},e.parseSsrcMedia=function(e){var t=e.indexOf(' '),n={ssrc:parseInt(e.substr(7,t-7),10)},s=e.indexOf(':',t);return s>-1?(n.attribute=e.substr(t+1,s-t-1),n.value=e.substr(s+1)):n.attribute=e.substr(t+1),n},e.parseSsrcGroup=function(t){var e=t.substr(13).split(' ');return{semantics:e.shift(),ssrcs:e.map(function(e){return parseInt(e,10)})}},e.getMid=function(n){var t=e.matchPrefix(n,'a=mid:')[0];if(t)return t.substr(6)},e.parseFingerprint=function(t){var e=t.substr(14).split(' ');return{algorithm:e[0].toLowerCase(),value:e[1].toUpperCase()}},e.getDtlsParameters=function(t,n){var s=e.matchPrefix(t+n,'a=fingerprint:');return{role:'auto',fingerprints:s.map(e.parseFingerprint)}},e.writeDtlsParameters=function(t,n){var e='a=setup:'+n+'\r\n';return t.fingerprints.forEach(function(t){e+='a=fingerprint:'+t.algorithm+' '+t.value+'\r\n'}),e},e.parseCryptoLine=function(t){var e=t.substr(9).split(' ');return{tag:parseInt(e[0],10),cryptoSuite:e[1],keyParams:e[2],sessionParams:e.slice(3)}},e.writeCryptoLine=function(t){return'a=crypto:'+t.tag+' '+t.cryptoSuite+' '+(n(t.keyParams)==='object'?e.writeCryptoKeyParams(t.keyParams):t.keyParams)+(t.sessionParams?' '+t.sessionParams.join(' '):'')+'\r\n'},e.parseCryptoKeyParams=function(t){if(t.indexOf('inline:')!==0)return null;var e=t.substr(7).split('|');return{keyMethod:'inline',keySalt:e[0],lifeTime:e[1],mkiValue:e[2]?e[2].split(':')[0]:void 0,mkiLength:e[2]?e[2].split(':')[1]:void 0}},e.writeCryptoKeyParams=function(e){return e.keyMethod+':'+e.keySalt+(e.lifeTime?'|'+e.lifeTime:'')+(e.mkiValue&&e.mkiLength?'|'+e.mkiValue+':'+e.mkiLength:'')},e.getCryptoParameters=function(t,n){var s=e.matchPrefix(t+n,'a=crypto:');return s.map(e.parseCryptoLine)},e.getIceParameters=function(t,n){var s=e.matchPrefix(t+n,'a=ice-ufrag:')[0],o=e.matchPrefix(t+n,'a=ice-pwd:')[0];return s&&o?{usernameFragment:s.substr(12),password:o.substr(10)}:null},e.writeIceParameters=function(e){var t='a=ice-ufrag:'+e.usernameFragment+'\r\n'+'a=ice-pwd:'+e.password+'\r\n';return e.iceLite&&(t+='a=ice-lite\r\n'),t},e.parseRtpParameters=function(t){for(var s={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},i,c,n,a,l=e.splitLines(t),r=l[0].split(' '),o=3;r.length>o;o++)if(i=r[o],c=e.matchPrefix(t,'a=rtpmap:'+i+' ')[0],c)switch(n=e.parseRtpMap(c),a=e.matchPrefix(t,'a=fmtp:'+i+' '),n.parameters=a.length?e.parseFmtp(a[0]):{},n.rtcpFeedback=e.matchPrefix(t,'a=rtcp-fb:'+i+' ').map(e.parseRtcpFb),s.codecs.push(n),n.name.toUpperCase()){case'RED':case'ULPFEC':s.fecMechanisms.push(n.name.toUpperCase());break;default:break}return e.matchPrefix(t,'a=extmap:').forEach(function(t){s.headerExtensions.push(e.parseExtmap(t))}),s},e.writeRtpDescription=function(o,n){var t='',s;return t+='m='+o+' ',t+=n.codecs.length>0?'9':'0',t+=' UDP/TLS/RTP/SAVPF ',t+=n.codecs.map(function(e){return e.preferredPayloadType!==void 0?e.preferredPayloadType:e.payloadType}).join(' ')+'\r\n',t+='c=IN IP4 0.0.0.0\r\n',t+='a=rtcp:9 IN IP4 0.0.0.0\r\n',n.codecs.forEach(function(n){t+=e.writeRtpMap(n),t+=e.writeFmtp(n),t+=e.writeRtcpFb(n)}),s=0,n.codecs.forEach(function(e){e.maxptime>s&&(s=e.maxptime)}),s>0&&(t+='a=maxptime:'+s+'\r\n'),n.headerExtensions&&n.headerExtensions.forEach(function(n){t+=e.writeExtmap(n)}),t},e.parseRtpEncodingParameters=function(i){var s=[],t,r=e.parseRtpParameters(i),d=r.fecMechanisms.indexOf('RED')!==-1,l=r.fecMechanisms.indexOf('ULPFEC')!==-1,c=e.matchPrefix(i,'a=ssrc:').map(function(t){return e.parseSsrcMedia(t)}).filter(function(e){return e.attribute==='cname'}),n=c.length>0&&c[0].ssrc,a=void 0,o=e.matchPrefix(i,'a=ssrc-group:FID').map(function(e){var t=e.substr(17).split(' ');return t.map(function(e){return parseInt(e,10)})});return o.length>0&&o[0].length>1&&o[0][0]===n&&(a=o[0][1]),r.codecs.forEach(function(t){if(t.name.toUpperCase()==='RTX'&&t.parameters.apt){var e={ssrc:n,codecPayloadType:parseInt(t.parameters.apt,10)};n&&a&&(e.rtx={ssrc:a}),s.push(e),d&&(e=JSON.parse(JSON.stringify(e)),e.fec={ssrc:n,mechanism:l?'red+ulpfec':'red'},s.push(e))}}),s.length===0&&n&&s.push({ssrc:n}),t=e.matchPrefix(i,'b='),t.length&&(t[0].indexOf('b=TIAS:')===0?t=parseInt(t[0].substr(7),10):t[0].indexOf('b=AS:')===0?t=parseInt(t[0].substr(5),10)*1e3*.95-50*40*8:t=void 0,s.forEach(function(e){e.maxBitrate=t})),s},e.parseRtcpParameters=function(n){var t={},o,i,s=e.matchPrefix(n,'a=ssrc:').map(function(t){return e.parseSsrcMedia(t)}).filter(function(e){return e.attribute==='cname'})[0];return s&&(t.cname=s.value,t.ssrc=s.ssrc),o=e.matchPrefix(n,'a=rtcp-rsize'),t.reducedSize=o.length>0,t.compound=o.length===0,i=e.matchPrefix(n,'a=rtcp-mux'),t.mux=i.length>0,t},e.writeRtcpParameters=function(e){var t='';return e.reducedSize&&(t+='a=rtcp-rsize\r\n'),e.mux&&(t+='a=rtcp-mux\r\n'),e.ssrc!==void 0&&e.cname&&(t+='a=ssrc:'+e.ssrc+' cname:'+e.cname+'\r\n'),t},e.parseMsid=function(n){var t=void 0,o,s=e.matchPrefix(n,'a=msid:');if(s.length===1)return t=s[0].substr(7).split(' '),{stream:t[0],track:t[1]};if(o=e.matchPrefix(n,'a=ssrc:').map(function(t){return e.parseSsrcMedia(t)}).filter(function(e){return e.attribute==='msid'}),o.length>0)return t=o[0].value.split(' '),{stream:t[0],track:t[1]}},e.parseSctpDescription=function(n){var r=e.parseMLine(n),o,i,a,s=e.matchPrefix(n,'a=max-message-size:'),t=void 0;if(s.length>0&&(t=parseInt(s[0].substr(19),10)),isNaN(t)&&(t=65536),o=e.matchPrefix(n,'a=sctp-port:'),o.length>0)return{port:parseInt(o[0].substr(12),10),protocol:r.fmt,maxMessageSize:t};if(i=e.matchPrefix(n,'a=sctpmap:'),i.length>0)return a=i[0].substr(10).split(' '),{port:parseInt(a[0],10),protocol:a[1],maxMessageSize:t}},e.writeSctpDescription=function(t,e){var n=[];return t.protocol!=='DTLS/SCTP'?n=['m='+t.kind+' 9 '+t.protocol+' '+e.protocol+'\r\n','c=IN IP4 0.0.0.0\r\n','a=sctp-port:'+e.port+'\r\n']:n=['m='+t.kind+' 9 '+t.protocol+' '+e.port+'\r\n','c=IN IP4 0.0.0.0\r\n','a=sctpmap:'+e.port+' '+e.protocol+' 65535\r\n'],e.maxMessageSize!==void 0&&n.push('a=max-message-size:'+e.maxMessageSize+'\r\n'),n.join('')},e.generateSessionId=function(){return Math.random().toString().substr(2,21)},e.writeSessionBoilerplate=function(n,s,o){var t=void 0,a,i=s!==void 0?s:2;return n?t=n:t=e.generateSessionId(),a=o||'thisisadapterortc','v=0\r\no='+a+' '+t+' '+i+' IN IP4 127.0.0.1\r\n'+'s=-\r\n'+'t=0 0\r\n'},e.getDirection=function(o,s){for(var n=e.splitLines(o),t=0;n.length>t;t++)switch(n[t]){case'a=sendrecv':case'a=sendonly':case'a=recvonly':case'a=inactive':return n[t].substr(2);default:}return s?e.getDirection(s):'sendrecv'},e.getKind=function(t){var n=e.splitLines(t),s=n[0].split(' ');return s[0].substr(2)},e.isRejected=function(e){return e.split(' ',2)[1]==='0'},e.parseMLine=function(n){var s=e.splitLines(n),t=s[0].substr(2).split(' ');return{kind:t[0],port:parseInt(t[1],10),protocol:t[2],fmt:t.slice(3).join(' ')}},e.parseOLine=function(n){var s=e.matchPrefix(n,'o=')[0],t=s.substr(2).split(' ');return{username:t[0],sessionId:t[1],sessionVersion:parseInt(t[2],10),netType:t[3],addressType:t[4],address:t[5]}},e.isValidSDP=function(n){if(typeof n!='string'||n.length===0)return!1;for(var s=e.splitLines(n),t=0;s.length>t;t++)if(2>s[t].length||s[t].charAt(1)!=='=')return!1;return!0},(typeof t=='undefined'?'undefined':n(t))==='object'&&(t.exports=e)},{}]},{},[1])(1)})// source: https://raw.githubusercontent.com/meetecho/janus-gateway/master/html/janus.js
/*
	The MIT License (MIT)

	Copyright (c) 2016 Meetecho

	Permission is hereby granted, free of charge, to any person obtaining
	a copy of this software and associated documentation files (the "Software"),
	to deal in the Software without restriction, including without limitation
	the rights to use, copy, modify, merge, publish, distribute, sublicense,
	and/or sell copies of the Software, and to permit persons to whom the
	Software is furnished to do so, subject to the following conditions:

	The above copyright notice and this permission notice shall be included
	in all copies or substantial portions of the Software.

	THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS
	OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
	FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL
	THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR
	OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE,
	ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR
	OTHER DEALINGS IN THE SOFTWARE.
 */
"use strict";Janus.sessions={},Janus.isExtensionEnabled=function(){if(navigator.mediaDevices&&navigator.mediaDevices.getDisplayMedia)return!0;if(window.navigator.userAgent.match('Chrome')){var e=parseInt(window.navigator.userAgent.match(/Chrome\/(.*) /)[1],10),t=33;return!!(window.navigator.userAgent.match('Linux')&&(t=35),e>=26&&t>=e)||Janus.extension.isInstalled()}return!0};var defaultExtension={extensionId:'hapfgfdkleiggjjpfpenajgdnfckjpaj',isInstalled:function(){return document.querySelector('#janus-extension-installed')!==null},getScreen:function(e){var t=window.setTimeout(function(){var t=new Error('NavigatorUserMediaError');return t.name='The required Chrome extension is not installed: click <a href="#">here</a> to install it. (NOTE: this will need you to refresh the page)',e(t)},1e3);this.cache[t]=e,window.postMessage({type:'janusGetScreen',id:t},'*')},init:function(){var e={};this.cache=e,window.addEventListener('message',function(t){if(t.origin!=window.location.origin)return;if(t.data.type=='janusGotScreen'&&e[t.data.id]){var n=e[t.data.id],s;delete e[t.data.id],t.data.sourceId===''?(s=new Error('NavigatorUserMediaError'),s.name='You cancelled the request for permission, giving up...',n(s)):n(null,t.data.sourceId)}else t.data.type=='janusGetScreenPending'&&(console.log('clearing ',t.data.id),window.clearTimeout(t.data.id))})}};Janus.useDefaultDependencies=function(e){var n=e&&e.fetch||fetch,t=e&&e.Promise||Promise,s=e&&e.WebSocket||WebSocket;return{newWebSocket:function(e,t){return new s(e,t)},extension:e&&e.extension||defaultExtension,isArray:function(e){return Array.isArray(e)},webRTCAdapter:e&&e.adapter||adapter,httpAPICall:function(i,e){var s={method:e.verb,headers:{Accept:'application/json, text/plain, */*'},cache:'no-cache'},o,a;return e.verb==="POST"&&(s.headers['Content-Type']='application/json'),e.withCredentials!==void 0&&(s.credentials=e.withCredentials===!0?'include':e.withCredentials?e.withCredentials:'omit'),e.body&&(s.body=JSON.stringify(e.body)),o=n(i,s).catch(function(e){return t.reject({message:'Probably a network error, is the server down?',error:e})}),e.timeout&&(a=new t(function(s,t){var n=setTimeout(function(){return clearTimeout(n),t({message:'Request timed out',timeout:e.timeout})},e.timeout)}),o=t.race([o,a])),o.then(function(n){if(n.ok){if(typeof e.success===typeof Janus.noop)return n.json().then(function(t){try{e.success(t)}catch(e){Janus.error('Unhandled httpAPICall success callback error',e)}},function(e){return t.reject({message:'Failed to parse response body',error:e,response:n})})}else return t.reject({message:'API call failed',response:n})}).catch(function(t){typeof e.error===typeof Janus.noop&&e.error(t.message||'<< internal error >>',t)}),o}}},Janus.useOldDependencies=function(e){var t=e&&e.jQuery||jQuery,n=e&&e.WebSocket||WebSocket;return{newWebSocket:function(e,t){return new n(e,t)},isArray:function(e){return t.isArray(e)},extension:e&&e.extension||defaultExtension,webRTCAdapter:e&&e.adapter||adapter,httpAPICall:function(n,e){var s=e.body!==void 0?{contentType:'application/json',data:JSON.stringify(e.body)}:{},o=e.withCredentials!==void 0?{xhrFields:{withCredentials:e.withCredentials}}:{};return t.ajax(t.extend(s,o,{url:n,type:e.verb,cache:!1,dataType:'json',async:e.async,timeout:e.timeout,success:function(t){typeof e.success===typeof Janus.noop&&e.success(t)},error:function(s,t,n){typeof e.error===typeof Janus.noop&&e.error(t,n)}}))}}},Janus.noop=function(){},Janus.dataChanDefaultLabel="JanusDataChannel",Janus.endOfCandidates=null,Janus.stopAllTracks=function(t){try{var n=t.getTracks(),e;for(e of n)Janus.log(e),e&&e.stop()}catch(e){}},Janus.init=function(e){if(e=e||{},e.callback=typeof e.callback=="function"?e.callback:Janus.noop,Janus.initDone)e.callback();else{if(typeof console.log=="undefined"&&(console.log=function(){}),Janus.trace=Janus.noop,Janus.debug=Janus.noop,Janus.vdebug=Janus.noop,Janus.log=Janus.noop,Janus.warn=Janus.noop,Janus.error=Janus.noop,e.debug===!0||e.debug==="all")Janus.trace=console.trace.bind(console),Janus.debug=console.debug.bind(console),Janus.vdebug=console.debug.bind(console),Janus.log=console.log.bind(console),Janus.warn=console.warn.bind(console),Janus.error=console.error.bind(console);else if(Array.isArray(e.debug))for(a of e.debug)switch(a){case"trace":Janus.trace=console.trace.bind(console);break;case"debug":Janus.debug=console.debug.bind(console);break;case"vdebug":Janus.vdebug=console.debug.bind(console);break;case"log":Janus.log=console.log.bind(console);break;case"warn":Janus.warn=console.warn.bind(console);break;case"error":Janus.error=console.error.bind(console);break;default:console.error("Unknown debugging option '"+a+"' (supported: 'trace', 'debug', 'vdebug', 'log', warn', 'error')");break}Janus.log("Initializing library");var a,t=e.dependencies||Janus.useDefaultDependencies(),c,i,s,o,n,r;if(Janus.isArray=t.isArray,Janus.webRTCAdapter=t.webRTCAdapter,Janus.httpAPICall=t.httpAPICall,Janus.newWebSocket=t.newWebSocket,Janus.extension=t.extension,Janus.extension.init(),Janus.listDevices=function(e,t){e=typeof e=="function"?e:Janus.noop,t==null&&(t={audio:!0,video:!0}),Janus.isGetUserMediaAvailable()?navigator.mediaDevices.getUserMedia(t).then(function(t){navigator.mediaDevices.enumerateDevices().then(function(n){Janus.debug(n),e(n),Janus.stopAllTracks(t)})}).catch(function(t){Janus.error(t),e([])}):(Janus.warn("navigator.mediaDevices unavailable"),e([]))},Janus.attachMediaStream=function(e,t){try{e.srcObject=t}catch(n){try{e.src=URL.createObjectURL(t)}catch(e){Janus.error("Error attaching stream to element")}}},Janus.reattachMediaStream=function(e,t){try{e.srcObject=t.srcObject}catch(n){try{e.src=t.src}catch(e){Janus.error("Error reattaching stream to element")}}},c=['iPad','iPhone','iPod'].indexOf(navigator.platform)>=0,i=c?'pagehide':'beforeunload',s=window["on"+i],window.addEventListener(i,function(){Janus.log("Closing window");for(var e in Janus.sessions)Janus.sessions[e]&&Janus.sessions[e].destroyOnUnload&&(Janus.log("Destroying session "+e),Janus.sessions[e].destroy({unload:!0,notifyDestroyed:!1}));s&&typeof s=="function"&&s()}),Janus.safariVp8=!1,Janus.webRTCAdapter.browserDetails.browser==='safari'&&Janus.webRTCAdapter.browserDetails.version>=605)if(RTCRtpSender&&RTCRtpSender.getCapabilities&&RTCRtpSender.getCapabilities("video")&&RTCRtpSender.getCapabilities("video").codecs&&RTCRtpSender.getCapabilities("video").codecs.length){for(o of RTCRtpSender.getCapabilities("video").codecs)if(o&&o.mimeType&&o.mimeType.toLowerCase()==="video/vp8"){Janus.safariVp8=!0;break}Janus.safariVp8?Janus.log("This version of Safari supports VP8"):Janus.warn("This version of Safari does NOT support VP8: if you're using a Technology Preview, try enabling the 'WebRTC VP8 codec' setting in the 'Experimental Features' Develop menu")}else n=new RTCPeerConnection({}),n.createOffer({offerToReceiveVideo:!0}).then(function(e){Janus.safariVp8=e.sdp.indexOf("VP8")!==-1,Janus.safariVp8?Janus.log("This version of Safari supports VP8"):Janus.warn("This version of Safari does NOT support VP8: if you're using a Technology Preview, try enabling the 'WebRTC VP8 codec' setting in the 'Experimental Features' Develop menu"),n.close(),n=null});if(Janus.unifiedPlan=!1,Janus.webRTCAdapter.browserDetails.browser==='firefox'&&Janus.webRTCAdapter.browserDetails.version>=59)Janus.unifiedPlan=!0;else if(Janus.webRTCAdapter.browserDetails.browser==='chrome'&&Janus.webRTCAdapter.browserDetails.version>=72)Janus.unifiedPlan=!0;else if(!window.RTCRtpTransceiver||!('currentDirection'in RTCRtpTransceiver.prototype))Janus.unifiedPlan=!1;else{r=new RTCPeerConnection;try{r.addTransceiver('audio'),Janus.unifiedPlan=!0}catch(e){}r.close()}Janus.initDone=!0,e.callback()}},Janus.isWebrtcSupported=function(){return!!window.RTCPeerConnection},Janus.isGetUserMediaAvailable=function(){return navigator.mediaDevices&&navigator.mediaDevices.getUserMedia},Janus.randomString=function(o){for(var e='ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789',s,t='',n=0;o>n;n++)s=Math.floor(Math.random()*e.length),t+=e.substring(s,s+1);return t};function Janus(e){if(e=e||{},e.success=typeof e.success=="function"?e.success:Janus.noop,e.error=typeof e.error=="function"?e.error:Janus.noop,e.destroyed=typeof e.destroyed=="function"?e.destroyed:Janus.noop,!Janus.initDone)return e.error("Library not initialized"),{};if(!Janus.isWebrtcSupported())return e.error("WebRTC not supported by this browser"),{};if(Janus.log("Library initialized: "+Janus.initDone),!e.server)return e.error("Invalid server url"),{};var r=!1,en,ee,J,Z,h,j,u,i,y,k,a,t,n,x,T,d,o=null,_={},g=null,m=null,v=0,s=e.server;Janus.isArray(s)?(Janus.log("Multiple servers provided ("+s.length+"), will use the first that works"),s=null,m=e.server,Janus.debug(m)):s.indexOf("ws")===0?(r=!0,Janus.log("Using WebSockets to contact Janus: "+s)):(r=!1,Janus.log("Using REST API to contact Janus: "+s)),en=e.iceServers||[{urls:"stun:stun.l.google.com:19302"}],ee=e.iceTransportPolicy,J=e.bundlePolicy,Z=e.ipv6===!0,h=!1,e.withCredentials!==void 0&&e.withCredentials!==null&&(h=e.withCredentials===!0),j=10,e.max_poll_events!==void 0&&e.max_poll_events!==null&&(j=e.max_poll_events),1>j&&(j=1),u=null,e.token!==void 0&&e.token!==null&&(u=e.token),i=null,e.apisecret!==void 0&&e.apisecret!==null&&(i=e.apisecret),this.destroyOnUnload=!0,e.destroyOnUnload!==void 0&&e.destroyOnUnload!==null&&(this.destroyOnUnload=e.destroyOnUnload===!0),y=25e3,e.keepAlivePeriod!==void 0&&e.keepAlivePeriod!==null&&(y=e.keepAlivePeriod),isNaN(y)&&(y=25e3),k=6e4,e.longPollTimeout!==void 0&&e.longPollTimeout!==null&&(k=e.longPollTimeout),isNaN(k)&&(k=6e4);function z(e){var t={high:9e5,medium:3e5,low:1e5};return e!==void 0&&e!==null&&(e.high&&(t.high=e.high),e.medium&&(t.medium=e.medium),e.low&&(t.low=e.low)),t}a=!1,t=null,n={},x=this,T=0,d={},A(e),this.getServer=function(){return s},this.isConnected=function(){return a},this.reconnect=function(e){e=e||{},e.success=typeof e.success=="function"?e.success:Janus.noop,e.error=typeof e.error=="function"?e.error:Janus.noop,e.reconnect=!0,A(e)},this.getSessionId=function(){return t},this.getInfo=function(e){G(e)},this.destroy=function(e){Q(e)},this.attach=function(e){K(e)};function F(){if(t==null)return;if(Janus.debug('Long poll...'),!a){Janus.warn("Is the server down? (connected=false)");return}var n=s+"/"+t+"?rid="+(new Date).getTime();j&&(n=n+"&maxev="+j),u&&(n=n+"&token="+encodeURIComponent(u)),i&&(n=n+"&apisecret="+encodeURIComponent(i)),Janus.httpAPICall(n,{verb:'GET',withCredentials:h,success:M,timeout:k,error:function(t,n){if(Janus.error(t+":",n),T++,T>3){a=!1,e.error("Lost connection to the server (is it down?)");return}F()}})}function M(e,p){if(T=0,!r&&t!==void 0&&t!==null&&p!==!0&&F(),!r&&Janus.isArray(e)){for(var c=0,i,s,l,h,a,m,u,f;e.length>c;c++)M(e[c],!0);return}if(e.janus==="keepalive"){Janus.vdebug("Got a keepalive on session "+t);return}if(e.janus==="server_info"){Janus.debug("Got info on the Janus instance"),Janus.debug(e);const t=e.transaction;if(t){const n=d[t];n&&n(e),delete d[t]}return}if(e.janus==="ack"){Janus.debug("Got an ack on session "+t),Janus.debug(e);const n=e.transaction;if(n){const t=d[n];t&&t(e),delete d[n]}return}if(e.janus==="success"){Janus.debug("Got a success on session "+t),Janus.debug(e);const n=e.transaction;if(n){const t=d[n];t&&t(e),delete d[n]}return}if(e.janus==="trickle"){const o=e.sender;if(!o){Janus.warn("Missing sender...");return}const a=n[o];if(!a){Janus.debug("This handle is not attached to this session");return}i=e.candidate,Janus.debug("Got a trickled candidate on session "+t),Janus.debug(i),s=a.webrtcStuff,s.pc&&s.remoteSdp?(Janus.debug("Adding remote candidate:",i),!i||i.completed===!0?s.pc.addIceCandidate(Janus.endOfCandidates):s.pc.addIceCandidate(i)):(Janus.debug("We didn't do setRemoteDescription (trickle got here before the offer?), caching candidate"),s.candidates||(s.candidates=[]),s.candidates.push(i),Janus.debug(s.candidates))}else if(e.janus==="webrtcup"){Janus.debug("Got a webrtcup event on session "+t),Janus.debug(e);const s=e.sender;if(!s){Janus.warn("Missing sender...");return}const o=n[s];if(!o){Janus.debug("This handle is not attached to this session");return}o.webrtcState(!0);return}else if(e.janus==="hangup"){Janus.debug("Got a hangup event on session "+t),Janus.debug(e);const o=e.sender;if(!o){Janus.warn("Missing sender...");return}const s=n[o];if(!s){Janus.debug("This handle is not attached to this session");return}s.webrtcState(!1,e.reason),s.hangup()}else if(e.janus==="detached"){Janus.debug("Got a detached event on session "+t),Janus.debug(e);const o=e.sender;if(!o){Janus.warn("Missing sender...");return}const s=n[o];if(!s)return;s.ondetached(),s.detach()}else if(e.janus==="media"){Janus.debug("Got a media event on session "+t),Janus.debug(e);const s=e.sender;if(!s){Janus.warn("Missing sender...");return}const o=n[s];if(!o){Janus.debug("This handle is not attached to this session");return}o.mediaState(e.type,e.receiving)}else if(e.janus==="slowlink"){Janus.debug("Got a slowlink event on session "+t),Janus.debug(e);const s=e.sender;if(!s){Janus.warn("Missing sender...");return}const o=n[s];if(!o){Janus.debug("This handle is not attached to this session");return}o.slowLink(e.uplink,e.lost)}else if(e.janus==="error"){Janus.error("Ooops: "+e.error.code+" "+e.error.reason),Janus.debug(e),l=e.transaction,l&&(h=d[l],h&&h(e),delete d[l]);return}else if(e.janus==="event"){Janus.debug("Got a plugin event on session "+t),Janus.debug(e);const s=e.sender;if(!s){Janus.warn("Missing sender...");return}if(a=e.plugindata,!a){Janus.warn("Missing plugindata...");return}Janus.debug("  -- Event is coming from "+s+" ("+a.plugin+")"),m=a.data,Janus.debug(m);const o=n[s];if(!o){Janus.warn("This handle is not attached to this session");return}u=e.jsep,u&&(Janus.debug("Handling SDP as well..."),Janus.debug(u)),f=o.onmessage,f?(Janus.debug("Notifying application..."),f(m,u)):Janus.debug("No provided notification callback")}else if(e.janus==="timeout"){Janus.error("Timeout on session "+t),Janus.debug(e),r&&o.close(3504,"Gateway timeout");return}else Janus.warn("Unknown message/event  '"+e.janus+"' on session "+t),Janus.debug(e)}function R(){if(!s||!r||!a)return;g=setTimeout(R,y);var e={janus:"keepalive",session_id:t,transaction:Janus.randomString(12)};u&&(e.token=u),i&&(e.apisecret=i),o.send(JSON.stringify(e))}function A(n){var l=Janus.randomString(12),f,c={janus:"create",transaction:l};if(n.reconnect&&(a=!1,c.janus="claim",c.session_id=t,o&&(o.onopen=null,o.onerror=null,o.onclose=null,g&&(clearTimeout(g),g=null))),u&&(c.token=u),i&&(c.apisecret=i),!s&&Janus.isArray(m)&&(s=m[v],s.indexOf("ws")===0?(r=!0,Janus.log("Server #"+(v+1)+": trying WebSockets to contact Janus ("+s+")")):(r=!1,Janus.log("Server #"+(v+1)+": trying REST API to contact Janus ("+s+")"))),r){o=Janus.newWebSocket(s,'janus-protocol'),_={error:function(){if(Janus.error("Error connecting to the Janus WebSockets server... "+s),Janus.isArray(m)&&!n.reconnect){if(v++,v===m.length){n.error("Error connecting to any of the provided Janus servers: Is the server down?");return}s=null,setTimeout(function(){A(n)},200);return}n.error("Error connecting to the Janus WebSockets server: Is the server down?")},open:function(){d[l]=function(e){if(Janus.debug(e),e.janus!=="success"){Janus.error("Ooops: "+e.error.code+" "+e.error.reason),n.error(e.error.reason);return}g=setTimeout(R,y),a=!0,t=e.session_id?e.session_id:e.data.id,n.reconnect?Janus.log("Claimed session: "+t):Janus.log("Created session: "+t),Janus.sessions[t]=x,n.success()},o.send(JSON.stringify(c))},message:function(e){M(JSON.parse(e.data))},close:function(){if(!s||!a)return;a=!1,e.error("Lost connection to the server (is it down?)")}};for(f in _)o.addEventListener(f,_[f]);return}Janus.httpAPICall(s,{verb:'POST',withCredentials:h,body:c,success:function(e){if(Janus.debug(e),e.janus!=="success"){Janus.error("Ooops: "+e.error.code+" "+e.error.reason),n.error(e.error.reason);return}a=!0,t=e.session_id?e.session_id:e.data.id,n.reconnect?Janus.log("Claimed session: "+t):Janus.log("Created session: "+t),Janus.sessions[t]=x,F(),n.success()},error:function(e,t){if(Janus.error(e+":",t),Janus.isArray(m)&&!n.reconnect){if(v++,v===m.length){n.error("Error connecting to any of the provided Janus servers: Is the server down?");return}s=null,setTimeout(function(){A(n)},200);return}t===""?n.error(e+": Is the server down?"):n.error(e+": "+t)}})}function G(e){if(e=e||{},e.success=typeof e.success=="function"?e.success:Janus.noop,e.error=typeof e.error=="function"?e.error:Janus.noop,Janus.log("Getting info on Janus instance"),!a){Janus.warn("Is the server down? (connected=false)"),e.error("Is the server down? (connected=false)");return}var n=Janus.randomString(12),t={janus:"info",transaction:n};if(u&&(t.token=u),i&&(t.apisecret=i),r){d[n]=function(t){Janus.log("Server info:"),Janus.debug(t),t.janus!=="server_info"&&Janus.error("Ooops: "+t.error.code+" "+t.error.reason),e.success(t)},o.send(JSON.stringify(t));return}Janus.httpAPICall(s,{verb:'POST',withCredentials:h,body:t,success:function(t){Janus.log("Server info:"),Janus.debug(t),t.janus!=="server_info"&&Janus.error("Ooops: "+t.error.code+" "+t.error.reason),e.success(t)},error:function(t,n){Janus.error(t+":",n),n===""?e.error(t+": Is the server down?"):e.error(t+": "+n)}})}function Q(c){c=c||{},c.success=typeof c.success=="function"?c.success:Janus.noop,c.error=typeof c.error=="function"?c.error:Janus.noop;var f=c.unload===!0,b,j,l,p,v,m,d=!0;if(c.notifyDestroyed!==void 0&&c.notifyDestroyed!==null&&(d=c.notifyDestroyed===!0),b=c.cleanupHandles===!0,Janus.log("Destroying session "+t+" (unload="+f+")"),!t){Janus.warn("No session to destroy"),c.success(),d&&e.destroyed();return}if(b)for(j in n)N(j,{noRequest:!0});if(!a){Janus.warn("Is the server down? (connected=false)"),t=null,c.success();return}if(l={janus:"destroy",transaction:Janus.randomString(12)},u&&(l.token=u),i&&(l.apisecret=i),f){r?(o.onclose=null,o.close(),o=null):navigator.sendBeacon(s+"/"+t,JSON.stringify(l)),Janus.log("Destroyed session:"),t=null,a=!1,c.success(),d&&e.destroyed();return}if(r){l.session_id=t,p=function(){for(var e in _)o.removeEventListener(e,_[e]);o.removeEventListener('message',v),o.removeEventListener('error',m),g&&clearTimeout(g),o.close()},v=function(n){var t=JSON.parse(n.data);t.session_id==l.session_id&&t.transaction==l.transaction&&(p(),c.success(),d&&e.destroyed())},m=function(){p(),c.error("Failed to destroy the server: Is the server down?"),d&&e.destroyed()},o.addEventListener('message',v),o.addEventListener('error',m),o.readyState===1?o.send(JSON.stringify(l)):m();return}Janus.httpAPICall(s+"/"+t,{verb:'POST',withCredentials:h,body:l,success:function(n){Janus.log("Destroyed session:"),Janus.debug(n),t=null,a=!1,n.janus!=="success"&&Janus.error("Ooops: "+n.error.code+" "+n.error.reason),c.success(),d&&e.destroyed()},error:function(n,s){Janus.error(n+":",s),t=null,a=!1,c.success(),d&&e.destroyed()}})}function K(e){if(e=e||{},e.success=typeof e.success=="function"?e.success:Janus.noop,e.error=typeof e.error=="function"?e.error:Janus.noop,e.dataChannelOptions=e.dataChannelOptions||{ordered:!0},e.consentDialog=typeof e.consentDialog=="function"?e.consentDialog:Janus.noop,e.iceState=typeof e.iceState=="function"?e.iceState:Janus.noop,e.mediaState=typeof e.mediaState=="function"?e.mediaState:Janus.noop,e.webrtcState=typeof e.webrtcState=="function"?e.webrtcState:Janus.noop,e.slowLink=typeof e.slowLink=="function"?e.slowLink:Janus.noop,e.onmessage=typeof e.onmessage=="function"?e.onmessage:Janus.noop,e.onlocalstream=typeof e.onlocalstream=="function"?e.onlocalstream:Janus.noop,e.onremotestream=typeof e.onremotestream=="function"?e.onremotestream:Janus.noop,e.ondata=typeof e.ondata=="function"?e.ondata:Janus.noop,e.ondataopen=typeof e.ondataopen=="function"?e.ondataopen:Janus.noop,e.oncleanup=typeof e.oncleanup=="function"?e.oncleanup:Janus.noop,e.ondetached=typeof e.ondetached=="function"?e.ondetached:Janus.noop,!a){Janus.warn("Is the server down? (connected=false)"),e.error("Is the server down? (connected=false)");return}var c=e.plugin,g,v,m,p,l;if(!c){Janus.error("Invalid plugin"),e.error("Invalid plugin");return}if(g=e.opaqueId,v=e.loopIndex,m=e.token?e.token:u,p=Janus.randomString(12),l={janus:"attach",plugin:c,opaque_id:g,loop_index:v,transaction:p},m&&(l.token=m),i&&(l.apisecret=i),r){d[p]=function(s){if(Janus.debug(s),s.janus!=="success"){Janus.error("Ooops: "+s.error.code+" "+s.error.reason),e.error("Ooops: "+s.error.code+" "+s.error.reason);return}var t=s.data.id,o;Janus.log("Created handle: "+t),o={session:x,plugin:c,id:t,token:m,detached:!1,webrtcStuff:{started:!1,myStream:null,streamExternal:!1,remoteStream:null,mySdp:null,mediaConstraints:null,pc:null,dataChannelOptions:e.dataChannelOptions,dataChannel:{},dtmfSender:null,trickle:!0,iceDone:!1,volume:{value:null,timer:null},bitrate:{value:null,bsnow:null,bsbefore:null,tsnow:null,tsbefore:null,timer:null}},getId:function(){return t},getPlugin:function(){return c},getVolume:function(){return b(t,!0)},getRemoteVolume:function(){return b(t,!0)},getLocalVolume:function(){return b(t,!1)},isAudioMuted:function(){return C(t,!1)},muteAudio:function(){return f(t,!1,!0)},unmuteAudio:function(){return f(t,!1,!1)},isVideoMuted:function(){return C(t,!0)},muteVideo:function(){return f(t,!0,!0)},unmuteVideo:function(){return f(t,!0,!1)},getBitrate:function(){return V(t)},send:function(e){L(t,e)},data:function(e){P(t,e)},dtmf:function(e){$(t,e)},consentDialog:e.consentDialog,iceState:e.iceState,mediaState:e.mediaState,webrtcState:e.webrtcState,slowLink:e.slowLink,onmessage:e.onmessage,createOffer:function(e){E(t,!0,e)},createAnswer:function(e){E(t,!1,e)},handleRemoteJsep:function(e){I(t,e)},onlocalstream:e.onlocalstream,onremotestream:e.onremotestream,ondata:e.ondata,ondataopen:e.ondataopen,oncleanup:e.oncleanup,ondetached:e.ondetached,hangup:function(e){S(t,e===!0)},detach:function(e){N(t,e)}},n[t]=o,e.success(o)},l.session_id=t,o.send(JSON.stringify(l));return}Janus.httpAPICall(s+"/"+t,{verb:'POST',withCredentials:h,body:l,success:function(s){if(Janus.debug(s),s.janus!=="success"){Janus.error("Ooops: "+s.error.code+" "+s.error.reason),e.error("Ooops: "+s.error.code+" "+s.error.reason);return}var t=s.data.id,o;Janus.log("Created handle: "+t),o={session:x,plugin:c,id:t,token:m,detached:!1,webrtcStuff:{started:!1,myStream:null,streamExternal:!1,remoteStream:null,mySdp:null,mediaConstraints:null,pc:null,dataChannelOptions:e.dataChannelOptions,dataChannel:{},dtmfSender:null,trickle:!0,iceDone:!1,volume:{value:null,timer:null},bitrate:{value:null,bsnow:null,bsbefore:null,tsnow:null,tsbefore:null,timer:null}},getId:function(){return t},getPlugin:function(){return c},getVolume:function(){return b(t,!0)},getRemoteVolume:function(){return b(t,!0)},getLocalVolume:function(){return b(t,!1)},isAudioMuted:function(){return C(t,!1)},muteAudio:function(){return f(t,!1,!0)},unmuteAudio:function(){return f(t,!1,!1)},isVideoMuted:function(){return C(t,!0)},muteVideo:function(){return f(t,!0,!0)},unmuteVideo:function(){return f(t,!0,!1)},getBitrate:function(){return V(t)},send:function(e){L(t,e)},data:function(e){P(t,e)},dtmf:function(e){$(t,e)},consentDialog:e.consentDialog,iceState:e.iceState,mediaState:e.mediaState,webrtcState:e.webrtcState,slowLink:e.slowLink,onmessage:e.onmessage,createOffer:function(e){E(t,!0,e)},createAnswer:function(e){E(t,!1,e)},handleRemoteJsep:function(e){I(t,e)},onlocalstream:e.onlocalstream,onremotestream:e.onremotestream,ondata:e.ondata,ondataopen:e.ondataopen,oncleanup:e.oncleanup,ondetached:e.ondetached,hangup:function(e){S(t,e===!0)},detach:function(e){N(t,e)}},n[t]=o,e.success(o)},error:function(t,n){Janus.error(t+":",n),n===""?e.error(t+": Is the server down?"):e.error(t+": "+n)}})}function L(m,e){if(e=e||{},e.success=typeof e.success=="function"?e.success:Janus.noop,e.error=typeof e.error=="function"?e.error:Janus.noop,!a){Janus.warn("Is the server down? (connected=false)"),e.error("Is the server down? (connected=false)");return}var u=n[m],p,l,f,c;if(!u||!u.webrtcStuff){Janus.warn("Invalid handle"),e.error("Invalid handle");return}if(p=e.message,l=e.jsep,f=Janus.randomString(12),c={janus:"message",body:p,transaction:f},u.token&&(c.token=u.token),i&&(c.apisecret=i),l&&(c.jsep={type:l.type,sdp:l.sdp},l.e2ee&&(c.jsep.e2ee=!0),(l.rid_order==="hml"||l.rid_order==="lmh")&&(c.jsep.rid_order=l.rid_order),l.force_relay&&(c.jsep.force_relay=!0)),Janus.debug("Sending message to plugin (handle="+m+"):"),Janus.debug(c),r){c.session_id=t,c.handle_id=m,d[f]=function(t){if(Janus.debug("Message sent!"),Janus.debug(t),t.janus==="success"){var n=t.plugindata,s;if(!n){Janus.warn("Request succeeded, but missing plugindata..."),e.success();return}Janus.log("Synchronous transaction successful ("+n.plugin+")"),s=n.data,Janus.debug(s),e.success(s);return}if(t.janus!=="ack"){t.error?(Janus.error("Ooops: "+t.error.code+" "+t.error.reason),e.error(t.error.code+" "+t.error.reason)):(Janus.error("Unknown error"),e.error("Unknown error"));return}e.success()},o.send(JSON.stringify(c));return}Janus.httpAPICall(s+"/"+t+"/"+m,{verb:'POST',withCredentials:h,body:c,success:function(t){if(Janus.debug("Message sent!"),Janus.debug(t),t.janus==="success"){var n=t.plugindata,s;if(!n){Janus.warn("Request succeeded, but missing plugindata..."),e.success();return}Janus.log("Synchronous transaction successful ("+n.plugin+")"),s=n.data,Janus.debug(s),e.success(s);return}if(t.janus!=="ack"){t.error?(Janus.error("Ooops: "+t.error.code+" "+t.error.reason),e.error(t.error.code+" "+t.error.reason)):(Janus.error("Unknown error"),e.error("Unknown error"));return}e.success()},error:function(t,n){Janus.error(t+":",n),e.error(t+": "+n)}})}function H(c,d){if(!a){Janus.warn("Is the server down? (connected=false)");return}var l=n[c],e;if(!l||!l.webrtcStuff){Janus.warn("Invalid handle");return}if(e={janus:"trickle",candidate:d,transaction:Janus.randomString(12)},l.token&&(e.token=l.token),i&&(e.apisecret=i),Janus.vdebug("Sending trickle candidate (handle="+c+"):"),Janus.vdebug(e),r){e.session_id=t,e.handle_id=c,o.send(JSON.stringify(e));return}Janus.httpAPICall(s+"/"+t+"/"+c,{verb:'POST',withCredentials:h,body:e,success:function(e){if(Janus.vdebug("Candidate sent!"),Janus.vdebug(e),e.janus!=="ack"){Janus.error("Ooops: "+e.error.code+" "+e.error.reason);return}},error:function(e,t){Janus.error(e+":",t)}})}function D(l,t,o,i,a){var s=n[l],e,d,r,u,c;if(!s||!s.webrtcStuff){Janus.warn("Invalid handle");return}if(e=s.webrtcStuff,!e.pc){Janus.warn("Invalid PeerConnection");return}d=function(e){Janus.log('Received message on data channel:',e);var t=e.target.label;s.ondata(e.data,t)},r=function(n){Janus.log('Received state change on data channel:',n);var t=n.target.label,i,a=n.target.protocol,o=e.dataChannel[t]?e.dataChannel[t].readyState:"null";if(Janus.log('State change on <'+t+'> data channel: '+o),o==='open'){if(e.dataChannel[t].pending&&e.dataChannel[t].pending.length>0){Janus.log("Sending pending messages on <"+t+">:",e.dataChannel[t].pending.length);for(i of e.dataChannel[t].pending)Janus.log("Sending data on data channel <"+t+">"),Janus.debug(i),e.dataChannel[t].send(i);e.dataChannel[t].pending=[]}s.ondataopen(t,a)}},u=function(e){Janus.error('Got error on data channel:',e)},i?e.dataChannel[t]=i:(c=e.dataChannelOptions,o&&(c.protocol=o),e.dataChannel[t]=e.pc.createDataChannel(t,c)),e.dataChannel[t].onmessage=d,e.dataChannel[t].onopen=r,e.dataChannel[t].onclose=r,e.dataChannel[t].onerror=u,e.dataChannel[t].pending=[],a&&e.dataChannel[t].pending.push(a)}function P(a,e){e=e||{},e.success=typeof e.success=="function"?e.success:Janus.noop,e.error=typeof e.error=="function"?e.error:Janus.noop;var i=n[a],o,s,t;if(!i||!i.webrtcStuff){Janus.warn("Invalid handle"),e.error("Invalid handle");return}if(o=i.webrtcStuff,s=e.text||e.data,!s){Janus.warn("Invalid data"),e.error("Invalid data");return}if(t=e.label?e.label:Janus.dataChanDefaultLabel,!o.dataChannel[t]){D(a,t,e.protocol,!1,s,e.protocol),e.success();return}if(o.dataChannel[t].readyState!=="open"){o.dataChannel[t].pending.push(s),e.success();return}Janus.log("Sending data on data channel <"+t+">"),Janus.debug(s),o.dataChannel[t].send(s),e.success()}function $(d,e){e=e||{},e.success=typeof e.success=="function"?e.success:Janus.noop,e.error=typeof e.error=="function"?e.error:Janus.noop;var o=n[d],t,l,a,s,i,r,c;if(!o||!o.webrtcStuff){Janus.warn("Invalid handle"),e.error("Invalid handle");return}if(t=o.webrtcStuff,!t.dtmfSender){if(t.pc){if(l=t.pc.getSenders(),a=l.find(function(e){return e.track&&e.track.kind==='audio'}),!a){Janus.warn("Invalid DTMF configuration (no audio track)"),e.error("Invalid DTMF configuration (no audio track)");return}t.dtmfSender=a.dtmf,t.dtmfSender&&(Janus.log("Created DTMF Sender"),t.dtmfSender.ontonechange=function(e){Janus.debug("Sent DTMF tone: "+e.tone)})}if(!t.dtmfSender){Janus.warn("Invalid DTMF configuration"),e.error("Invalid DTMF configuration");return}}if(s=e.dtmf,!s){Janus.warn("Invalid DTMF parameters"),e.error("Invalid DTMF parameters");return}if(i=s.tones,!i){Janus.warn("Invalid DTMF string"),e.error("Invalid DTMF string");return}r=typeof s.duration=='number'?s.duration:500,c=typeof s.gap=='number'?s.gap:50,Janus.debug("Sending DTMF string "+i+" (duration "+r+"ms, gap "+c+"ms)"),t.dtmfSender.insertDTMF(i,r,c),e.success()}function N(c,e){e=e||{},e.success=typeof e.success=="function"?e.success:Janus.noop,e.error=typeof e.error=="function"?e.error:Janus.noop;var u=e.noRequest===!0,d,l;if(Janus.log("Destroying handle "+c+" (only-locally="+u+")"),S(c),d=n[c],!d||d.detached){delete n[c],e.success();return}if(d.detached=!0,u){delete n[c],e.success();return}if(!a){Janus.warn("Is the server down? (connected=false)"),e.error("Is the server down? (connected=false)");return}if(l={janus:"detach",transaction:Janus.randomString(12)},d.token&&(l.token=d.token),i&&(l.apisecret=i),r){l.session_id=t,l.handle_id=c,o.send(JSON.stringify(l)),delete n[c],e.success();return}Janus.httpAPICall(s+"/"+t+"/"+c,{verb:'POST',withCredentials:h,body:l,success:function(t){Janus.log("Destroyed handle:"),Janus.debug(t),t.janus!=="success"&&Janus.error("Ooops: "+t.error.code+" "+t.error.reason),delete n[c],e.success()},error:function(t,s){Janus.error(t+":",s),delete n[c],e.success()}})}function p(a,f,s,o,t){var i=n[a],e,g,u,h,r,d,v,p,m;if(!i||!i.webrtcStuff){Janus.warn("Invalid handle"),o.stream||Janus.stopAllTracks(t),o.error("Invalid handle");return}if(e=i.webrtcStuff,Janus.debug("streamsDone:",t),t&&(Janus.debug("  -- Audio tracks:",t.getAudioTracks()),Janus.debug("  -- Video tracks:",t.getVideoTracks())),g=!1,!e.myStream||!s.update||e.streamExternal&&!s.replaceAudio&&!s.replaceVideo)e.myStream=t,g=!0;else{if((!s.update&&c(s)||s.update&&(s.addAudio||s.replaceAudio))&&t.getAudioTracks()&&t.getAudioTracks().length)if(e.myStream.addTrack(t.getAudioTracks()[0]),Janus.unifiedPlan){Janus.log((s.replaceAudio?"Replacing":"Adding")+" audio track:",t.getAudioTracks()[0]),u=null;const n=e.pc.getTransceivers();if(n&&n.length>0)for(const e of n)if(e.sender&&e.sender.track&&e.sender.track.kind==="audio"||e.receiver&&e.receiver.track&&e.receiver.track.kind==="audio"){u=e;break}u&&u.sender?u.sender.replaceTrack(t.getAudioTracks()[0]):e.pc.addTrack(t.getAudioTracks()[0],t)}else Janus.log((s.replaceAudio?"Replacing":"Adding")+" audio track:",t.getAudioTracks()[0]),e.pc.addTrack(t.getAudioTracks()[0],t);if((!s.update&&l(s)||s.update&&(s.addVideo||s.replaceVideo))&&t.getVideoTracks()&&t.getVideoTracks().length)if(e.myStream.addTrack(t.getVideoTracks()[0]),Janus.unifiedPlan){Janus.log((s.replaceVideo?"Replacing":"Adding")+" video track:",t.getVideoTracks()[0]),h=null;const n=e.pc.getTransceivers();if(n&&n.length>0)for(const e of n)if(e.sender&&e.sender.track&&e.sender.track.kind==="video"||e.receiver&&e.receiver.track&&e.receiver.track.kind==="video"){h=e;break}h&&h.sender?h.sender.replaceTrack(t.getVideoTracks()[0]):e.pc.addTrack(t.getVideoTracks()[0],t)}else Janus.log((s.replaceVideo?"Replacing":"Adding")+" video track:",t.getVideoTracks()[0]),e.pc.addTrack(t.getVideoTracks()[0],t)}if(!e.pc){if(r={iceServers:en,iceTransportPolicy:ee,bundlePolicy:J},Janus.webRTCAdapter.browserDetails.browser==="chrome"&&(r.sdpSemantics=72>Janus.webRTCAdapter.browserDetails.version?"plan-b":"unified-plan"),d={optional:[{DtlsSrtpKeyAgreement:!0}]},Z&&d.optional.push({googIPv6:!0}),o.rtcConstraints&&typeof o.rtcConstraints=='object'){Janus.debug("Adding custom PeerConnection constraints:",o.rtcConstraints);for(v in o.rtcConstraints)d.optional.push(o.rtcConstraints[v])}Janus.webRTCAdapter.browserDetails.browser==="edge"&&(r.bundlePolicy="max-bundle"),RTCRtpSender&&(RTCRtpSender.prototype.createEncodedStreams||RTCRtpSender.prototype.createEncodedAudioStreams&&RTCRtpSender.prototype.createEncodedVideoStreams)&&(o.senderTransforms||o.receiverTransforms)&&(e.senderTransforms=o.senderTransforms,e.receiverTransforms=o.receiverTransforms,r.forceEncodedAudioInsertableStreams=!0,r.forceEncodedVideoInsertableStreams=!0,r.encodedInsertableStreams=!0),Janus.log("Creating PeerConnection"),Janus.debug(d),e.pc=new RTCPeerConnection(r,d),Janus.debug(e.pc),e.pc.getStats&&(e.volume={},e.bitrate.value="0 kbits/sec"),Janus.log("Preparing local SDP and gathering candidates (trickle="+e.trickle+")"),e.pc.oniceconnectionstatechange=function(){e.pc&&i.iceState(e.pc.iceConnectionState)},e.pc.onicecandidate=function(t){if(!t.candidate||Janus.webRTCAdapter.browserDetails.browser==='edge'&&t.candidate.candidate.indexOf('endOfCandidates')>0)Janus.log("End of candidates."),e.iceDone=!0,e.trickle===!0?H(a,{completed:!0}):W(a,o);else{var n={candidate:t.candidate.candidate,sdpMid:t.candidate.sdpMid,sdpMLineIndex:t.candidate.sdpMLineIndex};e.trickle===!0&&H(a,n)}},e.pc.ontrack=function(t){if(Janus.log("Handling Remote Track"),Janus.debug(t),!t.streams)return;if(e.remoteStream=t.streams[0],i.onremotestream(e.remoteStream),t.track.onended)return;if(e.receiverTransforms){var n=null,s;RTCRtpSender.prototype.createEncodedStreams?n=t.receiver.createEncodedStreams():(RTCRtpSender.prototype.createAudioEncodedStreams||RTCRtpSender.prototype.createEncodedVideoStreams)&&(t.track.kind==="audio"&&e.receiverTransforms.audio?n=t.receiver.createEncodedAudioStreams():t.track.kind==="video"&&e.receiverTransforms.video&&(n=t.receiver.createEncodedVideoStreams())),n&&(console.log(n),n.readableStream&&n.writableStream?n.readableStream.pipeThrough(e.receiverTransforms[t.track.kind]).pipeTo(n.writableStream):n.readable&&n.writable&&n.readable.pipeThrough(e.receiverTransforms[t.track.kind]).pipeTo(n.writable))}s=null,Janus.log("Adding onended callback to track:",t.track),t.track.onended=function(t){Janus.log("Remote track removed:",t),e.remoteStream&&(clearTimeout(s),e.remoteStream.removeTrack(t.target),i.onremotestream(e.remoteStream))},t.track.onmute=function(t){Janus.log("Remote track muted:",t),e.remoteStream&&s==null&&(s=setTimeout(function(){Janus.log("Removing remote track"),e.remoteStream&&(e.remoteStream.removeTrack(t.target),i.onremotestream(e.remoteStream)),s=null},3*840))},t.track.onunmute=function(t){if(Janus.log("Remote track flowing again:",t),s!=null)clearTimeout(s),s=null;else try{e.remoteStream.addTrack(t.target),i.onremotestream(e.remoteStream)}catch(e){Janus.error(e)}}}}g&&t&&(Janus.log('Adding local stream'),p=o.simulcast2===!0,m=o.svc,t.getTracks().forEach(function(i){Janus.log('Adding local track:',i);var s=null,n;if(!p&&!m||i.kind==='audio')s=e.pc.addTrack(i,t);else if(p){Janus.log('Enabling rid-based simulcasting:',i);let n=z(o.simulcastMaxBitrates),a=e.pc.addTransceiver(i,{direction:"sendrecv",streams:[t],sendEncodings:o.sendEncodings||[{rid:"h",active:!0,maxBitrate:n.high},{rid:"m",active:!0,maxBitrate:n.medium,scaleResolutionDownBy:2},{rid:"l",active:!0,maxBitrate:n.low,scaleResolutionDownBy:4}]});a&&(s=a.sender)}else{Janus.log('Enabling SVC ('+m+'):',i);let n=e.pc.addTransceiver(i,{direction:"sendrecv",streams:[t],sendEncodings:[{scalabilityMode:m}]});n&&(s=n.sender)}s&&e.senderTransforms&&(n=null,RTCRtpSender.prototype.createEncodedStreams?n=s.createEncodedStreams():(RTCRtpSender.prototype.createAudioEncodedStreams||RTCRtpSender.prototype.createEncodedVideoStreams)&&(s.track.kind==="audio"&&e.senderTransforms.audio?n=s.createEncodedAudioStreams():s.track.kind==="video"&&e.senderTransforms.video&&(n=s.createEncodedVideoStreams())),n&&(console.log(n),n.readableStream&&n.writableStream?n.readableStream.pipeThrough(e.senderTransforms[s.track.kind]).pipeTo(n.writableStream):n.readable&&n.writable&&n.readable.pipeThrough(e.senderTransforms[s.track.kind]).pipeTo(n.writable)))})),eo(s)&&!e.dataChannel[Janus.dataChanDefaultLabel]&&(Janus.log("Creating default data channel"),D(a,Janus.dataChanDefaultLabel,null,!1),e.pc.ondatachannel=function(e){Janus.log("Data channel created by Janus:",e),D(a,e.channel.label,e.channel.protocol,e.channel)}),e.myStream&&i.onlocalstream(e.myStream),f?e.pc.setRemoteDescription(f).then(function(){if(Janus.log("Remote description accepted!"),e.remoteSdp=f.sdp,e.candidates&&e.candidates.length>0){for(var n=0,t;e.candidates.length>n;n++)t=e.candidates[n],Janus.debug("Adding remote candidate:",t),!t||t.completed===!0?e.pc.addIceCandidate(Janus.endOfCandidates):e.pc.addIceCandidate(t);e.candidates=[]}q(a,s,o)},o.error):Y(a,s,o)}function E(d,C,t){t=t||{},t.success=typeof t.success=="function"?t.success:Janus.noop,t.error=typeof t.error=="function"?t.error:B;var i=t.jsep,e,o,s,g,x,m,b,w,f,v,a,j,h,k,A,E,u,r,O,_,y;if(C&&i){Janus.error("Provided a JSEP to a createOffer"),t.error("Provided a JSEP to a createOffer");return}if(!C&&(!i||!i.type||!i.sdp)){Janus.error("A valid JSEP is required for createAnswer"),t.error("A valid JSEP is required for createAnswer");return}if(t.media=typeof t.media=='object'&&t.media?t.media:{audio:!0,video:!0},e=t.media,o=n[d],!o||!o.webrtcStuff){Janus.warn("Invalid handle"),t.error("Invalid handle");return}if(s=o.webrtcStuff,s.trickle=U(t.trickle),s.pc){{if(Janus.log("Updating existing media session"),e.update=!0,t.stream)t.stream!==s.myStream&&Janus.log("Renegotiation involves a new external stream");else{if(e.addAudio){if(e.keepAudio=!1,e.replaceAudio=!1,e.removeAudio=!1,e.audioSend=!0,s.myStream&&s.myStream.getAudioTracks()&&s.myStream.getAudioTracks().length){Janus.error("Can't add audio stream, there already is one"),t.error("Can't add audio stream, there already is one");return}}else e.removeAudio?(e.keepAudio=!1,e.replaceAudio=!1,e.addAudio=!1,e.audioSend=!1):e.replaceAudio&&(e.keepAudio=!1,e.addAudio=!1,e.removeAudio=!1,e.audioSend=!0);if(s.myStream?!s.myStream.getAudioTracks()||s.myStream.getAudioTracks().length===0?(e.replaceAudio&&(e.keepAudio=!1,e.replaceAudio=!1,e.addAudio=!0,e.audioSend=!0),c(e)&&(e.keepAudio=!1,e.addAudio=!0)):c(e)&&!e.removeAudio&&!e.replaceAudio&&(e.keepAudio=!0):(e.replaceAudio&&(e.keepAudio=!1,e.replaceAudio=!1,e.addAudio=!0,e.audioSend=!0),c(e)&&(e.keepAudio=!1,e.addAudio=!0)),e.addVideo){if(e.keepVideo=!1,e.replaceVideo=!1,e.removeVideo=!1,e.videoSend=!0,s.myStream&&s.myStream.getVideoTracks()&&s.myStream.getVideoTracks().length){Janus.error("Can't add video stream, there already is one"),t.error("Can't add video stream, there already is one");return}}else e.removeVideo?(e.keepVideo=!1,e.replaceVideo=!1,e.addVideo=!1,e.videoSend=!1):e.replaceVideo&&(e.keepVideo=!1,e.addVideo=!1,e.removeVideo=!1,e.videoSend=!0);s.myStream?!s.myStream.getVideoTracks()||s.myStream.getVideoTracks().length===0?(e.replaceVideo&&(e.keepVideo=!1,e.replaceVideo=!1,e.addVideo=!0,e.videoSend=!0),l(e)&&(e.keepVideo=!1,e.addVideo=!0)):l(e)&&!e.removeVideo&&!e.replaceVideo&&(e.keepVideo=!0):(e.replaceVideo&&(e.keepVideo=!1,e.replaceVideo=!1,e.addVideo=!0,e.videoSend=!0),l(e)&&(e.keepVideo=!1,e.addVideo=!0)),e.addData&&(e.data=!0)}if(c(e)&&e.keepAudio&&l(e)&&e.keepVideo){o.consentDialog(!1),p(d,i,e,t,s.myStream);return}}}else e.update=!1,e.keepAudio=!1,e.keepVideo=!1;if(e.update&&(!s.streamExternal||s.streamExternal&&(e.replaceAudio||e.replaceVideo))){if(e.removeAudio||e.replaceAudio){if(s.myStream&&s.myStream.getAudioTracks()&&s.myStream.getAudioTracks().length){g=s.myStream.getAudioTracks()[0],Janus.log("Removing audio track:",g),s.myStream.removeTrack(g);try{g.stop()}catch(e){}}if(s.pc.getSenders()&&s.pc.getSenders().length)if(x=!0,e.replaceAudio&&Janus.unifiedPlan&&(x=!1),x)for(m of s.pc.getSenders())m&&m.track&&m.track.kind==="audio"&&(Janus.log("Removing audio sender:",m),s.pc.removeTrack(m))}if(e.removeVideo||e.replaceVideo){if(s.myStream&&s.myStream.getVideoTracks()&&s.myStream.getVideoTracks().length){b=s.myStream.getVideoTracks()[0],Janus.log("Removing video track:",b),s.myStream.removeTrack(b);try{b.stop()}catch(e){}}if(s.pc.getSenders()&&s.pc.getSenders().length)if(w=!0,e.replaceVideo&&Janus.unifiedPlan&&(w=!1),w)for(f of s.pc.getSenders())f&&f.track&&f.track.kind==="video"&&(Janus.log("Removing video sender:",f),s.pc.removeTrack(f))}}if(t.stream){v=t.stream,Janus.log("MediaStream provided by the application"),Janus.debug(v),e.update&&s.myStream&&s.myStream!==t.stream&&!s.streamExternal&&!e.replaceAudio&&!e.replaceVideo&&(Janus.stopAllTracks(s.myStream),s.myStream=null),s.streamExternal=!0,o.consentDialog(!1),p(d,i,e,t,v);return}if(c(e)||l(e)){if(!Janus.isGetUserMediaAvailable()){t.error("getUserMedia not available");return}if(a={mandatory:{},optional:[]},o.consentDialog(!0),j=c(e),j&&e&&typeof e.audio=='object'&&(j=e.audio),h=l(e),h&&e)if(k=t.simulcast===!0,A=t.simulcast2===!0,E=t.svc,(k||A||E)&&!i&&!e.video&&(e.video="hires"),e.video&&e.video!='screen'&&e.video!='window')typeof e.video=='object'?h=e.video:(u=0,r=0,e.video==='lowres'?(r=240,u=320):e.video==='lowres-16:9'?(r=180,u=320):e.video==='hires'||e.video==='hires-16:9'||e.video==='hdres'?(r=720,u=1280):e.video==='fhdres'?(r=1080,u=1920):e.video==='4kres'?(r=2160,u=3840):e.video==='stdres'?(r=480,u=640):e.video==='stdres-16:9'?(r=360,u=640):(Janus.log("Default video setting is stdres 4:3"),r=480,u=640),Janus.log("Adding media constraint:",e.video),h={height:{ideal:r},width:{ideal:u}},Janus.log("Adding video constraint:",h));else if(e.video==='screen'||e.video==='window'){if(navigator.mediaDevices&&navigator.mediaDevices.getDisplayMedia){a.video={},e.screenshareFrameRate&&(a.video.frameRate=e.screenshareFrameRate),e.screenshareHeight&&(a.video.height=e.screenshareHeight),e.screenshareWidth&&(a.video.width=e.screenshareWidth),a.audio=e.captureDesktopAudio,navigator.mediaDevices.getDisplayMedia(a).then(function(n){o.consentDialog(!1),c(e)&&!e.keepAudio?navigator.mediaDevices.getUserMedia({audio:!0,video:!1}).then(function(s){n.addTrack(s.getAudioTracks()[0]),p(d,i,e,t,n)}):p(d,i,e,t,n)},function(e){o.consentDialog(!1),t.error(e)});return}const n=function(n,s){o.consentDialog(!1),n?t.error(n):p(d,i,e,t,s)},s=function(t,e,n){Janus.log("Adding media constraint (screen capture)"),Janus.debug(t),navigator.mediaDevices.getUserMedia(t).then(function(t){n?navigator.mediaDevices.getUserMedia({audio:!0,video:!1}).then(function(n){t.addTrack(n.getAudioTracks()[0]),e(null,t)}):e(null,t)}).catch(function(t){o.consentDialog(!1),e(t)})};if(Janus.webRTCAdapter.browserDetails.browser==='chrome')O=Janus.webRTCAdapter.browserDetails.version,_=33,window.navigator.userAgent.match('Linux')&&(_=35),O>=26&&_>=O?(a={video:{mandatory:{googLeakyBucket:!0,maxWidth:window.screen.width,maxHeight:window.screen.height,minFrameRate:e.screenshareFrameRate,maxFrameRate:e.screenshareFrameRate,chromeMediaSource:'screen'}},audio:c(e)&&!e.keepAudio},s(a,n)):Janus.extension.getScreen(function(i,r){if(i)return o.consentDialog(!1),t.error(i);a={audio:!1,video:{mandatory:{chromeMediaSource:'desktop',maxWidth:window.screen.width,maxHeight:window.screen.height,minFrameRate:e.screenshareFrameRate,maxFrameRate:e.screenshareFrameRate},optional:[{googLeakyBucket:!0},{googTemporalLayeredScreencast:!0}]}},a.video.mandatory.chromeMediaSourceId=r,s(a,n,c(e)&&!e.keepAudio)});else if(Janus.webRTCAdapter.browserDetails.browser==='firefox')if(Janus.webRTCAdapter.browserDetails.version>=33)a={video:{mozMediaSource:e.video,mediaSource:e.video},audio:c(e)&&!e.keepAudio},s(a,function(t,e){if(n(t,e),!t)var s=e.currentTime,o=window.setInterval(function(){e||window.clearInterval(o),e.currentTime==s&&(window.clearInterval(o),e.onended&&e.onended()),s=e.currentTime},500)});else{y=new Error('NavigatorUserMediaError'),y.name='Your version of Firefox does not support screen sharing, please install Firefox 33 (or more recent versions)',o.consentDialog(!1),t.error(y);return}return}(!e||e.video!=='screen')&&navigator.mediaDevices.enumerateDevices().then(function(s){var a=s.some(function(e){return e.kind==='audioinput'}),r=es(e)||s.some(function(e){return e.kind==='videoinput'}),g,b,n,y=c(e),u=l(e),m=ei(e),f=et(e);if(y||u||m||f){if(g=!!y&&a,b=!!u&&r,!g&&!b)return o.consentDialog(!1),t.error('No capture device found'),!1;if(!g&&m)return o.consentDialog(!1),t.error('Audio capture is required, but no capture device found'),!1;if(!b&&f)return o.consentDialog(!1),t.error('Video capture is required, but no capture device found'),!1}n={audio:!!(a&&!e.keepAudio)&&j,video:!!(r&&!e.keepVideo)&&h},Janus.debug("getUserMedia constraints",n),!n.audio&&!n.video?(o.consentDialog(!1),p(d,i,e,t,v)):navigator.mediaDevices.getUserMedia(n).then(function(n){o.consentDialog(!1),p(d,i,e,t,n)}).catch(function(e){o.consentDialog(!1),t.error({code:e.code,name:e.name,message:e.message})})}).catch(function(e){o.consentDialog(!1),t.error(e)})}else p(d,i,e,t)}function I(i,e){e=e||{},e.success=typeof e.success=="function"?e.success:Janus.noop,e.error=typeof e.error=="function"?e.error:B,e.customizeSdp=typeof e.customizeSdp=="function"?e.customizeSdp:Janus.noop;var s=e.jsep,t,o=n[i];if(!o||!o.webrtcStuff){Janus.warn("Invalid handle"),e.error("Invalid handle");return}if(t=o.webrtcStuff,s){if(!t.pc){Janus.warn("Wait, no PeerConnection?? if this is an answer, use createAnswer and not handleRemoteJsep"),e.error("No PeerConnection: if this is an answer, use createAnswer and not handleRemoteJsep");return}e.customizeSdp(s),t.pc.setRemoteDescription(s).then(function(){if(Janus.log("Remote description accepted!"),t.remoteSdp=s.sdp,t.candidates&&t.candidates.length>0){for(var o=0,n;t.candidates.length>o;o++)n=t.candidates[o],Janus.debug("Adding remote candidate:",n),!n||n.completed===!0?t.pc.addIceCandidate(Janus.endOfCandidates):t.pc.addIceCandidate(n);t.candidates=[]}e.success()},e.error)}else e.error("Invalid JSEP")}function Y(x,a,s){if(s=s||{},s.success=typeof s.success=="function"?s.success:Janus.noop,s.error=typeof s.error=="function"?s.error:Janus.noop,s.customizeSdp=typeof s.customizeSdp=="function"?s.customizeSdp:Janus.noop,b=n[x],!b||!b.webrtcStuff){Janus.warn("Invalid handle"),s.error("Invalid handle");return}if(i=b.webrtcStuff,u=s.simulcast===!0,u?Janus.log("Creating offer (iceDone="+i.iceDone+", simulcast="+u+")"):Janus.log("Creating offer (iceDone="+i.iceDone+")"),r={},Janus.unifiedPlan){var b,i,u,r,e=null,t=null,o,f,p,d,h,_,y,j,m,g,v=i.pc.getTransceivers();if(v&&v.length>0)for(o of v){if(o.sender&&o.sender.track&&o.sender.track.kind==="audio"||o.receiver&&o.receiver.track&&o.receiver.track.kind==="audio"){e||(e=o);continue}if(o.sender&&o.sender.track&&o.sender.track.kind==="video"||o.receiver&&o.receiver.track&&o.receiver.track.kind==="video"){t||(t=o);continue}}f=c(a),p=O(a),!f&&!p?a.removeAudio&&e&&(e.setDirection?e.setDirection("inactive"):e.direction="inactive",Janus.log("Setting audio transceiver to inactive:",e)):f&&p?e&&(e.setDirection?e.setDirection("sendrecv"):e.direction="sendrecv",Janus.log("Setting audio transceiver to sendrecv:",e)):f&&!p?e&&(e.setDirection?e.setDirection("sendonly"):e.direction="sendonly",Janus.log("Setting audio transceiver to sendonly:",e)):!f&&p&&(e?(e.setDirection?e.setDirection("recvonly"):e.direction="recvonly",Janus.log("Setting audio transceiver to recvonly:",e)):(e=i.pc.addTransceiver("audio",{direction:"recvonly"}),Janus.log("Adding recvonly audio transceiver:",e))),d=l(a),h=w(a),!d&&!h?a.removeVideo&&t&&(t.setDirection?t.setDirection("inactive"):t.direction="inactive",Janus.log("Setting video transceiver to inactive:",t)):d&&h?t&&(t.setDirection?t.setDirection("sendrecv"):t.direction="sendrecv",Janus.log("Setting video transceiver to sendrecv:",t)):d&&!h?t&&(t.setDirection?t.setDirection("sendonly"):t.direction="sendonly",Janus.log("Setting video transceiver to sendonly:",t)):!d&&h&&(t?(t.setDirection?t.setDirection("recvonly"):t.direction="recvonly",Janus.log("Setting video transceiver to recvonly:",t)):(t=i.pc.addTransceiver("video",{direction:"recvonly"}),Janus.log("Adding recvonly video transceiver:",t)))}else r.offerToReceiveAudio=O(a),r.offerToReceiveVideo=w(a);_=s.iceRestart===!0,_&&(r.iceRestart=!0),Janus.debug(r),y=l(a),y&&u&&Janus.webRTCAdapter.browserDetails.browser==="firefox"&&(Janus.log("Enabling Simulcasting for Firefox (RID)"),j=i.pc.getSenders().find(function(e){return e.track&&e.track.kind==="video"}),j&&(m=j.getParameters(),m||(m={}),g=z(s.simulcastMaxBitrates),m.encodings=s.sendEncodings||[{rid:"h",active:!0,maxBitrate:g.high},{rid:"m",active:!0,maxBitrate:g.medium,scaleResolutionDownBy:2},{rid:"l",active:!0,maxBitrate:g.low,scaleResolutionDownBy:4}],j.setParameters(m))),i.pc.createOffer(r).then(function(e){Janus.debug(e);var t={type:e.type,sdp:e.sdp};if(s.customizeSdp(t),e.sdp=t.sdp,Janus.log("Setting local description"),y&&u&&(Janus.webRTCAdapter.browserDetails.browser==="chrome"||Janus.webRTCAdapter.browserDetails.browser==="safari"?(Janus.log("Enabling Simulcasting for Chrome (SDP munging)"),e.sdp=X(e.sdp)):Janus.webRTCAdapter.browserDetails.browser!=="firefox"&&Janus.warn("simulcast=true, but this is not Chrome nor Firefox, ignoring")),i.mySdp={type:"offer",sdp:e.sdp},i.pc.setLocalDescription(e).catch(s.error),i.mediaConstraints=r,!i.iceDone&&!i.trickle){Janus.log("Waiting for all candidates...");return}(i.senderTransforms||i.receiverTransforms)&&(e.e2ee=!0),s.success(e)},s.error)}function q(_,a,s){if(s=s||{},s.success=typeof s.success=="function"?s.success:Janus.noop,s.error=typeof s.error=="function"?s.error:Janus.noop,s.customizeSdp=typeof s.customizeSdp=="function"?s.customizeSdp:Janus.noop,v=n[_],!v||!v.webrtcStuff){Janus.warn("Invalid handle"),s.error("Invalid handle");return}if(o=v.webrtcStuff,u=s.simulcast===!0,u?Janus.log("Creating answer (iceDone="+o.iceDone+", simulcast="+u+")"):Janus.log("Creating answer (iceDone="+o.iceDone+")"),r=null,Janus.unifiedPlan){{r={};var v,o,u,r,e=null,t=null,i,f,h,m,d,j,b,y,p,g=o.pc.getTransceivers();if(g&&g.length>0)for(i of g){if(i.sender&&i.sender.track&&i.sender.track.kind==="audio"||i.receiver&&i.receiver.track&&i.receiver.track.kind==="audio"){e||(e=i);continue}if(i.sender&&i.sender.track&&i.sender.track.kind==="video"||i.receiver&&i.receiver.track&&i.receiver.track.kind==="video"){t||(t=i);continue}}if(f=c(a),h=O(a),!f&&!h){if(a.removeAudio&&e)try{e.setDirection?e.setDirection("inactive"):e.direction="inactive",Janus.log("Setting audio transceiver to inactive:",e)}catch(e){Janus.error(e)}}else if(f&&h){if(e)try{e.setDirection?e.setDirection("sendrecv"):e.direction="sendrecv",Janus.log("Setting audio transceiver to sendrecv:",e)}catch(e){Janus.error(e)}}else if(f&&!h)try{e&&(e.setDirection?e.setDirection("sendonly"):e.direction="sendonly",Janus.log("Setting audio transceiver to sendonly:",e))}catch(e){Janus.error(e)}else if(!f&&h)if(e)try{e.setDirection?e.setDirection("recvonly"):e.direction="recvonly",Janus.log("Setting audio transceiver to recvonly:",e)}catch(e){Janus.error(e)}else e=o.pc.addTransceiver("audio",{direction:"recvonly"}),Janus.log("Adding recvonly audio transceiver:",e);if(m=l(a),d=w(a),!m&&!d){if(a.removeVideo&&t)try{t.setDirection?t.setDirection("inactive"):t.direction="inactive",Janus.log("Setting video transceiver to inactive:",t)}catch(e){Janus.error(e)}}else if(m&&d){if(t)try{t.setDirection?t.setDirection("sendrecv"):t.direction="sendrecv",Janus.log("Setting video transceiver to sendrecv:",t)}catch(e){Janus.error(e)}}else if(m&&!d){if(t)try{t.setDirection?t.setDirection("sendonly"):t.direction="sendonly",Janus.log("Setting video transceiver to sendonly:",t)}catch(e){Janus.error(e)}}else if(!m&&d)if(t)try{t.setDirection?t.setDirection("recvonly"):t.direction="recvonly",Janus.log("Setting video transceiver to recvonly:",t)}catch(e){Janus.error(e)}else t=o.pc.addTransceiver("video",{direction:"recvonly"}),Janus.log("Adding recvonly video transceiver:",t)}}else Janus.webRTCAdapter.browserDetails.browser==="firefox"||Janus.webRTCAdapter.browserDetails.browser==="edge"?r={offerToReceiveAudio:O(a),offerToReceiveVideo:w(a)}:r={mandatory:{OfferToReceiveAudio:O(a),OfferToReceiveVideo:w(a)}};Janus.debug(r),j=l(a),j&&u&&Janus.webRTCAdapter.browserDetails.browser==="firefox"&&(Janus.log("Enabling Simulcasting for Firefox (RID)"),b=o.pc.getSenders()[1],Janus.log(b),y=b.getParameters(),Janus.log(y),p=z(s.simulcastMaxBitrates),b.setParameters({encodings:s.sendEncodings||[{rid:"h",active:!0,maxBitrate:p.high},{rid:"m",active:!0,maxBitrate:p.medium,scaleResolutionDownBy:2},{rid:"l",active:!0,maxBitrate:p.low,scaleResolutionDownBy:4}]})),o.pc.createAnswer(r).then(function(e){Janus.debug(e);var t={type:e.type,sdp:e.sdp};if(s.customizeSdp(t),e.sdp=t.sdp,Janus.log("Setting local description"),j&&u&&(Janus.webRTCAdapter.browserDetails.browser==="chrome"?Janus.warn("simulcast=true, but this is an answer, and video breaks in Chrome if we enable it"):Janus.webRTCAdapter.browserDetails.browser!=="firefox"&&Janus.warn("simulcast=true, but this is not Chrome nor Firefox, ignoring")),o.mySdp={type:"answer",sdp:e.sdp},o.pc.setLocalDescription(e).catch(s.error),o.mediaConstraints=r,!o.iceDone&&!o.trickle){Janus.log("Waiting for all candidates...");return}(o.senderTransforms||o.receiverTransforms)&&(e.e2ee=!0),s.success(e)},s.error)}function W(o,e){e=e||{},e.success=typeof e.success=="function"?e.success:Janus.noop,e.error=typeof e.error=="function"?e.error:Janus.noop;var s=n[o],t;if(!s||!s.webrtcStuff){Janus.warn("Invalid handle, not sending anything");return}if(t=s.webrtcStuff,Janus.log("Sending offer/answer SDP..."),!t.mySdp){Janus.warn("Local SDP instance is invalid, not sending anything...");return}t.mySdp={type:t.pc.localDescription.type,sdp:t.pc.localDescription.sdp},t.trickle===!1&&(t.mySdp.trickle=!1),Janus.debug(e),t.sdpSent=!0,e.success(t.mySdp)}function b(i,s){var o=n[i],t,e;return!o||!o.webrtcStuff?(Janus.warn("Invalid handle"),0):(t=s?"remote":"local",e=o.webrtcStuff,e.volume[t]||(e.volume[t]={value:0}),e.pc.getStats&&(Janus.webRTCAdapter.browserDetails.browser==="chrome"||Janus.webRTCAdapter.browserDetails.browser==="safari"))?s&&!e.remoteStream?(Janus.warn("Remote stream unavailable"),0):!s&&!e.myStream?(Janus.warn("Local stream unavailable"),0):e.volume[t].timer?e.volume[t].value:(Janus.log("Starting "+t+" volume monitor"),e.volume[t].timer=setInterval(function(){e.pc.getStats().then(function(n){n.forEach(function(n){if(!n||n.kind!=="audio")return;if(s&&!n.remoteSource||!s&&n.type!=="media-source")return;e.volume[t].value=n.audioLevel?n.audioLevel:0})})},200),0):(Janus.warn("Getting the "+t+" volume unsupported by browser"),0)}function C(s,o){var t=n[s],e;return!t||!t.webrtcStuff?(Janus.warn("Invalid handle"),!0):(e=t.webrtcStuff,!e.pc)?(Janus.warn("Invalid PeerConnection"),!0):e.myStream?o?!e.myStream.getVideoTracks()||e.myStream.getVideoTracks().length===0?(Janus.warn("No video track"),!0):!e.myStream.getVideoTracks()[0].enabled:!e.myStream.getAudioTracks()||e.myStream.getAudioTracks().length===0?(Janus.warn("No audio track"),!0):!e.myStream.getAudioTracks()[0].enabled:(Janus.warn("Invalid local MediaStream"),!0)}function f(o,i,s){var t=n[o],e;return!t||!t.webrtcStuff?(Janus.warn("Invalid handle"),!1):(e=t.webrtcStuff,!e.pc)?(Janus.warn("Invalid PeerConnection"),!1):e.myStream?i?!e.myStream.getVideoTracks()||e.myStream.getVideoTracks().length===0?(Janus.warn("No video track"),!1):(e.myStream.getVideoTracks()[0].enabled=!s,!0):!e.myStream.getAudioTracks()||e.myStream.getAudioTracks().length===0?(Janus.warn("No audio track"),!1):(e.myStream.getAudioTracks()[0].enabled=!s,!0):(Janus.warn("Invalid local MediaStream"),!1)}function V(s){var t=n[s],e;return!t||!t.webrtcStuff?(Janus.warn("Invalid handle"),"Invalid handle"):(e=t.webrtcStuff,!e.pc)?"Invalid PeerConnection":e.pc.getStats?e.bitrate.timer?e.bitrate.value:(Janus.log("Starting bitrate timer (via getStats)"),e.bitrate.timer=setInterval(function(){e.pc.getStats().then(function(t){t.forEach(function(t){if(!t)return;var n=!1,s,o;(t.mediaType==="video"||t.id.toLowerCase().indexOf("video")>-1)&&t.type==="inbound-rtp"&&0>t.id.indexOf("rtcp")?n=!0:t.type=='ssrc'&&t.bytesReceived&&(t.googCodecName==="VP8"||t.googCodecName==="")&&(n=!0),n&&(e.bitrate.bsnow=t.bytesReceived,e.bitrate.tsnow=t.timestamp,e.bitrate.bsbefore===null||e.bitrate.tsbefore===null?(e.bitrate.bsbefore=e.bitrate.bsnow,e.bitrate.tsbefore=e.bitrate.tsnow):(s=e.bitrate.tsnow-e.bitrate.tsbefore,Janus.webRTCAdapter.browserDetails.browser==="safari"&&(s=s/1e3),o=Math.round((e.bitrate.bsnow-e.bitrate.bsbefore)*8/s),Janus.webRTCAdapter.browserDetails.browser==="safari"&&(o=parseInt(o/1e3)),e.bitrate.value=o+' kbits/sec',e.bitrate.bsbefore=e.bitrate.bsnow,e.bitrate.tsbefore=e.bitrate.tsnow))})})},1e3),"0 kbits/sec"):(Janus.warn("Getting the video bitrate unsupported by browser"),"Feature unsupported by browser")}function B(e){Janus.error("WebRTC error:",e)}function S(l,d){Janus.log("Cleaning WebRTC stuff");var c=n[l],e,a;if(!c)return;if(e=c.webrtcStuff,e){d===!0&&(a={janus:"hangup",transaction:Janus.randomString(12)},c.token&&(a.token=c.token),i&&(a.apisecret=i),Janus.debug("Sending hangup request (handle="+l+"):"),Janus.debug(a),r?(a.session_id=t,a.handle_id=l,o.send(JSON.stringify(a))):Janus.httpAPICall(s+"/"+t+"/"+l,{verb:'POST',withCredentials:h,body:a})),e.remoteStream=null,e.volume&&(e.volume.local&&e.volume.local.timer&&clearInterval(e.volume.local.timer),e.volume.remote&&e.volume.remote.timer&&clearInterval(e.volume.remote.timer)),e.volume={},e.bitrate.timer&&clearInterval(e.bitrate.timer),e.bitrate.timer=null,e.bitrate.bsnow=null,e.bitrate.bsbefore=null,e.bitrate.tsnow=null,e.bitrate.tsbefore=null,e.bitrate.value=null,!e.streamExternal&&e.myStream&&(Janus.log("Stopping local stream tracks"),Janus.stopAllTracks(e.myStream)),e.streamExternal=!1,e.myStream=null;try{e.pc.close()}catch(e){}e.pc=null,e.candidates=null,e.mySdp=null,e.remoteSdp=null,e.iceDone=!1,e.dataChannel={},e.dtmfSender=null,e.senderTransforms=null,e.receiverTransforms=null}c.oncleanup()}function X(a){e=a.split("\r\n"),u=!1,t=[-1],s=[-1];var e,u,t,s,l=null,r=null,d=null,c=null,f,h,o,m,i,n=-1;for(let i=0;e.length>i;i++){const m=e[i].match(/m=(\w+) */);if(m){const e=m[1];if(e==="video")if(0>t[0])u=!0;else{n=i;break}else if(t[0]>-1){n=i;break}continue}if(!u)continue;if(f=e[i].match(/a=ssrc-group:SIM (\d+) (\d+) (\d+)/),f)return Janus.warn("The SDP already contains a SIM attribute, munging will be skipped"),a;if(h=e[i].match(/a=ssrc-group:FID (\d+) (\d+)/),h){t[0]=h[1],s[0]=h[2],e.splice(i,1),i--;continue}if(t[0]){if(o=e[i].match('a=ssrc:'+t[0]+' cname:(.+)'),o&&(l=o[1]),o=e[i].match('a=ssrc:'+t[0]+' msid:(.+)'),o&&(r=o[1]),o=e[i].match('a=ssrc:'+t[0]+' mslabel:(.+)'),o&&(d=o[1]),o=e[i].match('a=ssrc:'+t[0]+' label:(.+)'),o&&(c=o[1]),e[i].indexOf('a=ssrc:'+s[0])===0){e.splice(i,1),i--;continue}if(e[i].indexOf('a=ssrc:'+t[0])===0){e.splice(i,1),i--;continue}}if(e[i].length==0){e.splice(i,1),i--;continue}}if(0>t[0]){n=-1,u=!1;for(let o=0;e.length>o;o++){const i=e[o].match(/m=(\w+) */);if(i){const e=i[1];if(e==="video")if(0>t[0])u=!0;else{n=o;break}else if(t[0]>-1){n=o;break}continue}if(!u)continue;if(0>t[0]){if(m=e[o].match(/a=ssrc:(\d+)/),m){t[0]=m[1],e.splice(o,1),o--;continue}}else{let n=e[o].match('a=ssrc:'+t[0]+' cname:(.+)');if(n&&(l=n[1]),n=e[o].match('a=ssrc:'+t[0]+' msid:(.+)'),n&&(r=n[1]),n=e[o].match('a=ssrc:'+t[0]+' mslabel:(.+)'),n&&(d=n[1]),n=e[o].match('a=ssrc:'+t[0]+' label:(.+)'),n&&(c=n[1]),e[o].indexOf('a=ssrc:'+s[0])===0){e.splice(o,1),o--;continue}if(e[o].indexOf('a=ssrc:'+t[0])===0){e.splice(o,1),o--;continue}}if(e[o].length===0){e.splice(o,1),o--;continue}}}if(0>t[0])return Janus.warn("Couldn't find the video SSRC, simulcasting NOT enabled"),a;0>n&&(n=e.length),t[1]=Math.floor(Math.random()*4294967295),t[2]=Math.floor(Math.random()*4294967295),s[1]=Math.floor(Math.random()*4294967295),s[2]=Math.floor(Math.random()*4294967295);for(i=0;t.length>i;i++)l&&(e.splice(n,0,'a=ssrc:'+t[i]+' cname:'+l),n++),r&&(e.splice(n,0,'a=ssrc:'+t[i]+' msid:'+r),n++),d&&(e.splice(n,0,'a=ssrc:'+t[i]+' mslabel:'+d),n++),c&&(e.splice(n,0,'a=ssrc:'+t[i]+' label:'+c),n++),l&&(e.splice(n,0,'a=ssrc:'+s[i]+' cname:'+l),n++),r&&(e.splice(n,0,'a=ssrc:'+s[i]+' msid:'+r),n++),d&&(e.splice(n,0,'a=ssrc:'+s[i]+' mslabel:'+d),n++),c&&(e.splice(n,0,'a=ssrc:'+s[i]+' label:'+c),n++);return e.splice(n,0,'a=ssrc-group:FID '+t[2]+' '+s[2]),e.splice(n,0,'a=ssrc-group:FID '+t[1]+' '+s[1]),e.splice(n,0,'a=ssrc-group:FID '+t[0]+' '+s[0]),e.splice(n,0,'a=ssrc-group:SIM '+t[0]+' '+t[1]+' '+t[2]),a=e.join("\r\n"),a.endsWith("\r\n")||(a+="\r\n"),a}function c(e){return!!(Janus.debug("isAudioSendEnabled:",e),!e)||(e.audio!==!1&&(!!(e.audioSend===void 0||e.audioSend===null)||e.audioSend===!0))}function ei(e){return!(Janus.debug("isAudioSendRequired:",e),!e)&&(!(e.audio===!1||e.audioSend===!1)&&(!(e.failIfNoAudio===void 0||e.failIfNoAudio===null)&&e.failIfNoAudio===!0))}function O(e){return!!(Janus.debug("isAudioRecvEnabled:",e),!e)||(e.audio!==!1&&(!!(e.audioRecv===void 0||e.audioRecv===null)||e.audioRecv===!0))}function l(e){return!!(Janus.debug("isVideoSendEnabled:",e),!e)||(e.video!==!1&&(!!(e.videoSend===void 0||e.videoSend===null)||e.videoSend===!0))}function et(e){return!(Janus.debug("isVideoSendRequired:",e),!e)&&(!(e.video===!1||e.videoSend===!1)&&(!(e.failIfNoVideo===void 0||e.failIfNoVideo===null)&&e.failIfNoVideo===!0))}function w(e){return!!(Janus.debug("isVideoRecvEnabled:",e),!e)||(e.video!==!1&&(!!(e.videoRecv===void 0||e.videoRecv===null)||e.videoRecv===!0))}function es(t){if(Janus.debug("isScreenSendEnabled:",t),!t)return!1;if(typeof t.video!='object'||typeof t.video.mandatory!='object')return!1;var e=t.video.mandatory;return e.chromeMediaSource?e.chromeMediaSource==='desktop'||e.chromeMediaSource==='screen':e.mozMediaSource?e.mozMediaSource==='window'||e.mozMediaSource==='screen':!!e.mediaSource&&(e.mediaSource==='window'||e.mediaSource==='screen')}function eo(e){return Janus.debug("isDataEnabled:",e),Janus.webRTCAdapter.browserDetails.browser==="edge"?(Janus.warn("Edge doesn't support data channels yet"),!1):!(e===void 0||e===null)&&e.data===!0}function U(e){return Janus.debug("isTrickleEnabled:",e),!(e===!1)}}export default Janus;
